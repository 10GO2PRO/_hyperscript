(function(){var w=0;var T=function(){self.onmessage=function(r){switch(r.data.type){case"init":importScripts(r.data._hyperscript);importScripts.apply(self,r.data.extraScripts);var e=_hyperscript.internals.lexer.makeTokensObject(r.data.tokens,[],r.data.source);var t=_hyperscript.internals.parser.parseElement("hyperscript",e);postMessage({type:"didInit"});break;case"call":try{var a=self[r.data.function].apply(self,r.data.args);Promise.resolve(a).then(function(e){postMessage({type:"resolve",id:r.data.id,value:e})}).catch(function(e){postMessage({type:"reject",id:r.data.id,error:e.toString()})})}catch(e){postMessage({type:"reject",id:r.data.id,error:e.toString()})}break}}};_hyperscript.addFeature("worker",function(e,r,t){if(t.matchToken("worker")){var a=e.requireElement("dotOrColonPath",t);var n=a.evaluate();var s=n.split(".");var i=s.pop();var o=[];if(t.matchOpToken("(")){if(t.matchOpToken(")")){}else{do{var c=t.requireTokenType("STRING").value;var p=new URL(c,location.href).href;o.push(p)}while(t.matchOpToken(","));t.requireOpToken(")")}}var d=[];var u=t.consumed.length;var l=t.consumed.length;do{var f=e.parseAnyOf(["defFeature","jsFeature"],t);if(f){if(f.type==="defFeature"){d.push(f.name);l=t.consumed.length}else{if(t.hasMore())continue}}else break}while(t.matchToken("end")&&t.hasMore());var v=t.consumed.slice(u,l+1);var h=T.toString().split("/* WORKER BOUNDARY */")[1];var m=new Blob([h],{type:"text/javascript"});var y=new Worker(URL.createObjectURL(m));y.postMessage({type:"init",_hyperscript:r.hyperscriptUrl,extraScripts:o,tokens:v,source:t.source});var g=new Promise(function(r,e){y.addEventListener("message",function(e){if(e.data.type==="didInit")r()},{once:true})});var k={};d.forEach(function(r){k[r]=function(){var e=arguments;return new Promise(function(t,a){var n=w++;y.addEventListener("message",function e(r){if(r.data.id!==n)return;y.removeEventListener("message",e);if(r.data.type==="resolve")t(r.data.value);else a(r.data.error)});g.then(function(){y.postMessage({type:"call",function:r,args:Array.from(e),id:n})})})}});return{name:i,worker:y,execute:function(e){r.assignToNamespace(s,i,k)}}}})})();