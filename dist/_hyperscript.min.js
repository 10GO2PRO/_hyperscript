(function(e,r){if(typeof define==="function"&&define.amd){define([],r)}else{e._hyperscript=r()}})(typeof self!=="undefined"?self:this,function(){return function(){"use strict";var f=function(){var g={"+":"PLUS","-":"MINUS","*":"MULTIPLY",".":"PERIOD","\\":"BACKSLASH",":":"COLON","%":"PERCENT","|":"PIPE","!":"EXCLAMATION","?":"QUESTION","#":"POUND","&":"AMPERSAND",";":"SEMI",",":"COMMA","(":"L_PAREN",")":"R_PAREN","<":"L_ANG",">":"R_ANG","{":"L_BRACE","}":"R_BRACE","[":"L_BRACKET","]":"R_BRACKET","=":"EQUALS"};function k(e){return A(e)||x(e)||e==="-"||e==="_"}function b(e){return A(e)||x(e)||e==="-"||e==="_"||e===":"}function R(e){return e===" "||e==="\t"||L(e)}function C(e){return"[Line: "+e.line+", Column: "+e.col+"]"}function L(e){return e==="\r"||e==="\n"}function x(e){return e>="0"&&e<="9"}function A(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function S(r,t,e){function i(e,r){v.raiseParseError(e,r)}function n(e){var r=a(e);if(r){return r}else{i(this,"Expected '"+e+"' but found '"+m().value+"'")}}function a(e){if(m()&&m().op&&m().value===e){return c()}}function s(e,r,t,n){var a=l(e,r,t,n);if(a){return a}else{i(this,"Expected one of "+JSON.stringify([e,r,t]))}}function l(e,r,t,n){if(m()&&m().type&&[e,r,t,n].indexOf(m().type)>=0){return c()}}function u(e,r){var t=o(e,r);if(t){return t}else{i(this,"Expected '"+e+"' but found '"+m().value+"'")}}function o(e,r){var r=r||"IDENTIFIER";if(m()&&m().value===e&&m().type===r){return c()}}function c(){var e=r.shift();t.push(e);return e}function p(){return r.length>0}function m(){return r[0]}return{matchOpToken:a,requireOpToken:n,matchTokenType:l,requireTokenType:s,consumeToken:c,matchToken:o,requireToken:u,list:r,source:e,hasMore:p,currentToken:m}}function e(e){var r=e;var t=[];var n=0;var a=0;var i=1;var s="<START>";while(n<r.length){y();if(d()==="-"&&h()==="-"){o()}else{if(!T()&&d()==="."&&A(h())){t.push(c())}else if(!T()&&d()==="#"&&A(h())){t.push(p())}else if(A(d())){t.push(m())}else if(x(d())){t.push(f())}else if(d()==='"'||d()==="'"){t.push(v())}else if(g[d()]){t.push(l(g[d()],E()))}}}return S(t,[],r);function l(e,r){var t=u(e,r);t.op=true;return t}function u(e,r){return{type:e,value:r,start:n,end:n+1,column:a,line:i}}function o(){while(d()&&!L(d())){E()}E()}function c(){var e=u("CLASS_REF");var r=E();while(k(d())){r+=E()}e.value=r;e.end=n;return e}function p(){var e=u("ID_REF");var r=E();while(b(d())){r+=E()}e.value=r;e.end=n;return e}function m(){var e=u("IDENTIFIER");var r=E();while(A(d())){r+=E()}e.value=r;e.end=n;return e}function f(){var e=u("NUMBER");var r=E();while(x(d())){r+=E()}if(d()==="."){r+=E()}while(x(d())){r+=E()}e.value=r;e.end=n;return e}function v(){var e=u("STRING");var r=E();var t="";while(d()&&d()!==r){if(d()==="\\"){E()}t+=E()}if(d()!==r){throw Error("Unterminated string at "+C(e))}else{E()}e.value=t;e.end=n;return e}function d(){return r.charAt(n)}function h(){return r.charAt(n+1)}function E(){s=d();n++;a++;return s}function T(){return A(s)||x(s)||s===")"||s==="}"||s==="]"}function y(){while(d()&&R(d())){if(L(d())){a=0;i++}E()}}}return{tokenize:e}}();var v=function(){var a={};function e(e,r){a[e]=r}function n(e){var r=e.currentToken();var t=e.source;var n=t.split("\n");var a=r?r.line-1:n.length-1;var i=n[a];var s=r?r.column:i.length-1;return i+"\n"+" ".repeat(s)+"^^\n\n"}function r(e,r){r=(r||"Unexpected Token : "+e.currentToken().value)+"\n\n"+n(e);var t=new Error(r);t.tokens=e;throw t}function i(e,r,t){var n=a[e];if(n)return n(v,r,t)}function t(e,r){for(var t=0;t<e.length;t++){var n=e[t];var a=i(n,r);if(a){return a}}}function s(e){return i("hyperscript",e)}function l(e,r){if(e==null){return r}var t=e.transpile();if(e.next){return t+"\n"+l(e.next)}else{return t}}return{parseElement:i,parseAnyOf:t,parseHyperScript:s,raiseParseError:r,addGrammarElement:e,transpile:l}}();var t=function(){var n=["_","script","data-script"];function e(e,r){var t=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return t&&t.call(e,r)}function i(e,r){var t;if(window.CustomEvent&&typeof window.CustomEvent==="function"){t=new CustomEvent(e,{bubbles:true,cancelable:true,detail:r})}else{t=document.createEvent("CustomEvent");t.initCustomEvent(e,true,true,r)}return t}function r(e,r,t){var t=t||{};t["sentBy"]=e;var n=i(r,t);var a=e.dispatchEvent(n);return a}function t(e,r){if(e.length){for(var t=0;t<e.length;t++){r(e[t])}}else{r(e)}}function s(e){for(var r=0;r<n.length;r++){var t=n[r];if(e.hasAttribute(t)){return e.getAttribute(t)}}return null}function a(e,r){t(e.eventListeners,function(e){e(r)})}function l(e){n=e}function u(){return n.map(function(e){return"["+e+"]"}).join(", ")}function o(e,r){return Object.prototype.toString.call(e)==="[object "+r+"]"}function c(e,r,t){if(o(r,"Object")){var n=e;var a=r;var i="expression"}else if(o(r,"String")){var n=r;var i=e;var a=t}else{var n=e;var a={};var i="expression"}a=a||{};var s=v.parseElement(i,f.tokenize(n)).transpile();var l="(function("+Object.keys(a).join(",")+"){return "+s+"})";if(false)console.log("transpile: "+s);if(false)console.log("evalString: "+l);var u=Object.keys(a).map(function(e){return a[e]});if(false)console.log("args",u);return eval(l).apply(null,u)}function p(e){var r=s(e);if(r){var t=f.tokenize(r);var n=v.parseHyperScript(t);var a=v.transpile(n);if(false)console.log(a);var i=eval(a);i.applyEventListenersTo(e)}}function m(e,r,t,n){var a=new XMLHttpRequest;a.onload=function(){t(this.response)};a.open(e,r);a.send(JSON.stringify(n))}return{forEach:t,triggerEvent:r,matchesSelector:e,getScript:s,applyEventListeners:a,setScriptAttrs:l,initElement:p,evaluate:c,getScriptSelector:u,ajax:m}}();v.addGrammarElement("string",function(e,r){var t=r.matchTokenType("STRING");if(t){return{type:"string",token:t,transpile:function(){if(t.value.indexOf("'")===0){return"'"+t.value+"'"}else{return'"'+t.value+'"'}}}}});v.addGrammarElement("number",function(e,r){var t=r.matchTokenType("NUMBER");if(t){var n=t;var a=parseFloat(t.value);return{type:"number",value:a,numberToken:n,transpile:function(){return n.value}}}});v.addGrammarElement("idRef",function(e,r){var t=r.matchTokenType("ID_REF");if(t){return{type:"idRef",value:t.value.substr(1),transpile:function(){return"document.getElementById('"+this.value+"')"}}}});v.addGrammarElement("classRef",function(e,r){var t=r.matchTokenType("CLASS_REF");if(t){return{type:"classRef",value:t.value,className:function(){return this.value.substr(1)},transpile:function(){return"document.querySelectorAll('"+this.value+"')"}}}});v.addGrammarElement("attributeRef",function(e,r){if(r.matchOpToken("[")){var t=r.matchTokenType("IDENTIFIER");var n=null;if(r.matchOpToken("=")){n=e.parseElement("expression",r)}r.requireOpToken("]");return{type:"attribute_expression",name:t.value,value:n,transpile:function(){if(this.value){return"({name: '"+this.name+"', value: "+e.transpile(this.value)+"})"}else{return"({name: '"+this.name+"'})"}}}}});v.addGrammarElement("objectLiteral",function(r,e){if(e.matchOpToken("{")){var t=[];if(!e.matchOpToken("}")){do{var n=e.requireTokenType("IDENTIFIER");e.requireOpToken(":");var a=r.parseElement("expression",e);t.push({name:n,value:a})}while(e.matchOpToken(","));e.requireOpToken("}")}return{type:"objectLiteral",fields:t,transpile:function(){return"({"+t.map(function(e){return e.name.value+":"+r.transpile(e.value)}).join(", ")+"})"}}}});v.addGrammarElement("symbol",function(e,r){var t=r.matchTokenType("IDENTIFIER");if(t){return{type:"symbol",name:t.value,transpile:function(){return t.value}}}});v.addGrammarElement("implicitMeTarget",function(e,r){return{type:"implicitMeTarget",transpile:function(){return"[me]"}}});v.addGrammarElement("implicitAllTarget",function(e,r){return{type:"implicitAllTarget",transpile:function(){return'document.querySelectorAll("*")'}}});v.addGrammarElement("millisecondLiteral",function(e,r){var t=r.requireTokenType(r,"NUMBER");var n=1;if(r.matchToken("s")){n=1e3}else if(r.matchToken("ms")){}return{type:"millisecondLiteral",number:t,factor:n,transpile:function(){return parseFloat(this.number.value)}}});v.addGrammarElement("boolean",function(e,r){if(r.matchToken("true")){return{type:"boolean",transpile:function(){return"true"}}}else if(r.matchToken("false")){return{type:"boolean",transpile:function(){return"false"}}}});v.addGrammarElement("leaf",function(e,r){return e.parseAnyOf(["boolean","string","number","idRef","classRef","symbol","propertyRef","objectLiteral"],r)});v.addGrammarElement("propertyAccess",function(e,r,t){if(r.matchOpToken(".")){var n=r.requireTokenType("IDENTIFIER");var a={type:"propertyAccess",root:t,prop:n,transpile:function(){return e.transpile(t)+"."+n.value}};return v.parseElement("indirectExpression",r,a)}});v.addGrammarElement("functionCall",function(r,e,t){if(e.matchOpToken("(")){var n=[];do{n.push(r.parseElement("expression",e))}while(e.matchOpToken(","));e.requireOpToken(")");var a={type:"functionCall",root:t,args:n,transpile:function(){return r.transpile(t)+"("+n.map(function(e){return r.transpile(e)}).join(",")+")"}};return v.parseElement("indirectExpression",e,a)}});v.addGrammarElement("indirectExpression",function(e,r,t){var n=e.parseElement("propertyAccess",r,t);if(n){return n}var a=e.parseElement("functionCall",r,t);if(a){return a}return t});v.addGrammarElement("expression",function(e,r){var t=v.parseElement("leaf",r);if(t){return v.parseElement("indirectExpression",r,t)}v.raiseParseError(r,"Unexpected value: "+r.currentToken().value)});v.addGrammarElement("target",function(r,e){var t=r.parseAnyOf(["symbol","classRef","idRef"],e);if(t==null){r.raiseParseError(e,"Expected a valid target expression")}return{type:"target",value:t,transpile:function(e){if(t.type==="classRef"){return r.transpile(t)}else if(t.type==="idRef"){return"["+r.transpile(t)+"]"}else{return"["+r.transpile(t)+"]"}}}});v.addGrammarElement("command",function(e,r){return e.parseAnyOf(["onCmd","addCmd","removeCmd","toggleCmd","waitCmd","sendCmd","takeCmd","logCmd","callCmd","putCmd","ifCmd","requestCmd"],r)});v.addGrammarElement("commandList",function(e,r){var t=e.parseElement("command",r);if(t){r.matchToken("then");t.next=e.parseElement("commandList",r);return t}});v.addGrammarElement("hyperscript",function(r,e){var t=[];do{t.push(r.parseElement("eventListener",e))}while(e.matchToken("end")&&e.hasMore());if(e.hasMore()){r.raiseParseError(e)}return{type:"hyperscript",eventListeners:t,transpile:function(){return"(function(){\n"+"var eventListeners = []\n"+t.map(function(e){return"eventListeners.push("+r.transpile(e)+");\n"})+"      function applyEventListenersTo(elt) { _hyperscript.runtime.applyEventListeners(this, elt) }"+"      return {eventListeners:eventListeners, applyEventListenersTo:applyEventListenersTo}\n"+"})()"}}});v.addGrammarElement("eventListener",function(e,r){r.requireToken("on");var t=e.parseElement("dotPath",r);if(t==null){e.raiseParseError(r,"Expected event name")}if(r.matchToken("from")){var n=e.parseElement("target",r);if(n==null){e.raiseParseError(r,"Expected target value")}}else{var n=e.parseElement("implicitMeTarget",r)}var a=e.parseElement("commandList",r);var i={type:"eventListener",on:t,from:n,start:a,transpile:function(){return"(function(me){"+"var my = me;\n"+"_hyperscript.runtime.forEach( "+e.transpile(n)+", function(target){\n"+"  target.addEventListener('"+e.transpile(t)+"', function(event){\n"+e.transpile(a)+"  })\n"+"})\n"+"})"}};return i});v.addGrammarElement("addCmd",function(e,r){if(r.matchToken("add")){var t=e.parseElement("classRef",r);var n=null;if(t==null){n=e.parseElement("attributeRef",r);if(n==null){e.raiseParseError(r,"Expected either a class reference or attribute expression")}}if(r.matchToken("to")){var a=e.parseElement("target",r)}else{var a=e.parseElement("implicitMeTarget")}return{type:"addCmd",classRef:t,attributeRef:n,to:a,transpile:function(){if(this.classRef){return"_hyperscript.runtime.forEach( "+e.transpile(a)+", function (target) {"+"  target.classList.add('"+t.className()+"')"+"})"}else{return"_hyperscript.runtime.forEach( "+e.transpile(a)+", function (target) {"+"  target.setAttribute('"+n.name+"', "+e.transpile(n)+".value)"+"})"}}}}});v.addGrammarElement("removeCmd",function(e,r){if(r.matchToken("remove")){var t=e.parseElement("classRef",r);var n=null;var a=null;if(t==null){n=e.parseElement("attributeRef",r);if(n==null){a=e.parseElement("expression",r);if(a==null){e.raiseParseError(r,"Expected either a class reference, attribute expression or value expression")}}}if(r.matchToken("from")){var i=e.parseElement("target",r)}else{var i=e.parseElement("implicitMeTarget")}return{type:"removeCmd",classRef:t,attributeRef:n,elementExpr:a,from:i,transpile:function(){if(this.elementExpr){return"_hyperscript.runtime.forEach( "+e.transpile(a)+", function (target) {"+"  target.parentElement.removeChild(target)"+"})"}else{if(this.classRef){return"_hyperscript.runtime.forEach( "+e.transpile(i)+", function (target) {"+"  target.classList.remove('"+t.className()+"')"+"})"}else{return"_hyperscript.runtime.forEach( "+e.transpile(i)+", function (target) {"+"  target.removeAttribute('"+n.name+"')"+"})"}}}}}});v.addGrammarElement("toggleCmd",function(e,r){if(r.matchToken("toggle")){var t=e.parseElement("classRef",r);var n=null;if(t==null){n=e.parseElement("attributeRef",r);if(n==null){e.raiseParseError(r,"Expected either a class reference or attribute expression")}}if(r.matchToken("on")){var a=e.parseElement("target",r)}else{var a=e.parseElement("implicitMeTarget")}return{type:"toggleCmd",classRef:t,attributeRef:n,on:a,transpile:function(){if(this.classRef){return"_hyperscript.runtime.forEach( "+e.transpile(a)+", function (target) {"+"  target.classList.toggle('"+t.className()+"')"+"})"}else{return"_hyperscript.runtime.forEach( "+e.transpile(a)+", function (target) {"+"  if(target.hasAttribute('"+n.name+"')) {\n"+"    target.removeAttribute('"+n.name+"');\n"+"  } else { \n"+"    target.setAttribute('"+n.name+"', "+e.transpile(n)+".value)"+"  }"+"})"}}}}});v.addGrammarElement("waitCmd",function(r,e){if(e.matchToken("wait")){var t=r.parseElement("millisecondLiteral",e);return{type:"waitCmd",time:t,transpile:function(){var e=this.next;delete this.next;return"setTimeout(function () { "+r.transpile(e)+" }, "+r.transpile(this.time)+")"}}}});v.addGrammarElement("dotPath",function(e,r){var t=v.parseElement("symbol",r);var n=[];if(t){while(r.matchOpToken(".")){n.push(r.requireTokenType("IDENTIFIER"))}return{type:"dotPath",path:n,transpile:function(){return e.transpile(t)+n.join(".")}}}});v.addGrammarElement("sendCmd",function(e,r){if(r.matchToken("send")){var t=e.parseElement("dotPath",r);var n=e.parseElement("objectLiteral",r);if(r.matchToken("to")){var a=e.parseElement("target",r)}else{var a=e.parseElement("implicitMeTarget")}return{type:"sendCmd",eventName:t,details:n,to:a,transpile:function(){return"_hyperscript.runtime.forEach( "+e.transpile(a)+", function (target) {"+"  _hyperscript.runtime.triggerEvent(target, '"+e.transpile(t)+"',"+e.transpile(n,"{}")+")"+"})"}}}});v.addGrammarElement("takeCmd",function(r,e){if(e.matchToken("take")){var t=e.requireTokenType(e,"CLASS_REF");if(e.matchToken("from")){var n=r.parseElement("target",e)}else{var n=r.parseElement("implicitAllTarget")}return{type:"takeCmd",classRef:t,from:n,transpile:function(){var e=this.classRef.value.substr(1);return"  _hyperscript.runtime.forEach("+r.transpile(n)+", function (target) { target.classList.remove('"+e+"') }); "+"me.classList.add('"+e+"');"}}}});v.addGrammarElement("logCmd",function(r,e){if(e.matchToken("log")){var t=[r.parseElement("expression",e)];while(e.matchOpToken(",")){t.push(r.parseElement("expression",e))}if(e.matchToken("with")){var n=r.parseElement("expression",e)}return{type:"logCmd",exprs:t,withExpr:n,transpile:function(){if(n){return r.transpile(n)+"("+t.map(function(e){return r.transpile(e)}).join(", ")+")"}else{return"console.log("+t.map(function(e){return r.transpile(e)}).join(", ")+")"}}}}});v.addGrammarElement("callCmd",function(e,r){if(r.matchToken("call")){return{type:"callCmd",expr:e.parseElement("expression",r),transpile:function(){return"var it = "+e.transpile(this.expr)}}}});v.addGrammarElement("putCmd",function(r,e){if(e.matchToken("put")){var t=r.parseElement("expression",e);var n=e.matchToken("into")||e.matchToken("before")||e.matchToken("afterbegin")||e.matchToken("beforeend")||e.matchToken("after");if(n==null){r.raiseParseError(e,"Expected one of 'into', 'before', 'afterbegin', 'beforeend', 'after'")}var a=r.parseElement("target",e);var i=[];while(e.matchOpToken(".")){i.push(e.requireTokenType("IDENTIFIER").value)}var s=i.length===0&&n.value==="into";var l=s&&a.value.type==="symbol";if(s&&!l){r.raiseParseError(e,"Can only put directly into symbols, not references")}return{type:"putCmd",target:a,propPath:i,op:n.value,symbolWrite:l,value:t,transpile:function(){if(this.symbolWrite){return"var "+a.value.name+" = "+r.transpile(t)}else{var e=i.length===0?"":"."+i.join(".");if(this.op==="into"){return"_hyperscript.runtime.forEach( "+r.transpile(a)+", function (target) {"+"  target"+e+"="+r.transpile(t)+"})"}else if(this.op==="before"){return"_hyperscript.runtime.forEach( "+r.transpile(a)+", function (target) {"+"  target"+e+".insertAdjacentHTML('beforebegin', "+r.transpile(t)+")"+"})"}else if(this.op==="afterbegin"){return"_hyperscript.runtime.forEach( "+r.transpile(a)+", function (target) {"+"  target"+e+".insertAdjacentHTML('afterbegin', "+r.transpile(t)+")"+"})"}else if(this.op==="beforeend"){return"_hyperscript.runtime.forEach( "+r.transpile(a)+", function (target) {"+"  target"+e+".insertAdjacentHTML('beforeend', "+r.transpile(t)+")"+"})"}else if(this.op==="after"){return"_hyperscript.runtime.forEach( "+r.transpile(a)+", function (target) {"+"  target"+e+".insertAdjacentHTML('afterend', "+r.transpile(t)+")"+"})"}}}}}});v.addGrammarElement("ifCmd",function(e,r){if(r.matchToken("if")){var t=e.parseElement("expression",r);var n=e.parseElement("commandList",r);if(r.matchToken("else")){var a=e.parseElement("commandList",r)}if(r.hasMore()){r.requireToken("end")}return{type:"ifCmd",expr:t,trueBranch:n,falseBranch:a,transpile:function(){return"if("+e.transpile(t)+"){"+""+e.transpile(n)+"}"+"   else {"+e.transpile(a,"")+"}"}}}});v.addGrammarElement("requestCmd",function(r,e){if(e.matchToken("request")){var t=e.matchToken("GET")||e.matchToken("POST");if(t==null){r.raiseParseError(e,"Requires either GET or POST")}var n=r.parseElement("string",e);if(t==null){r.raiseParseError(e,"Requires a URL")}if(e.matchToken("with")){var a=r.parseElement("expression",e);if(t==null){r.raiseParseError(e,"Requires a URL")}}return{type:"requestCommand",method:t,transpile:function(){var e=this.next;delete this.next;return"_hyperscript.runtime.ajax('"+t.value+"', "+r.transpile(n)+", "+"function(it){ "+r.transpile(e)+" },"+r.transpile(a,"null")+")"}}}});function e(e){if(e){t.setScriptAttrs(e)}var r=function(){var e=document.querySelectorAll(t.getScriptSelector());t.forEach(e,function(e){n(e)})};if(document.readyState!=="loading"){r()}else{document.addEventListener("DOMContentLoaded",r)}return true}function n(e){t.initElement(e)}function r(e){return t.evaluate(e)}return{lexer:f,parser:v,runtime:t,evaluate:r,init:n,start:e}}()});