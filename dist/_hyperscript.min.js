(function(e,r){if(typeof define==="function"&&define.amd){define([],r)}else{e._hyperscript=r()}})(typeof self!=="undefined"?self:this,function(){return function(){"use strict";function c(e,r){for(var n in r){if(r.hasOwnProperty(n)){e[n]=r[n]}}return e}function r(e){try{return JSON.parse(e)}catch(e){n(e);return null}}function n(e){if(console.error){console.error(e)}else if(console.log){console.log("ERROR: ",e)}}function u(e,r){return new(e.bind.apply(e,[e].concat(r)))}var P=typeof self!=="undefined"?self:typeof global!=="undefined"?global:this;var F=function(){var g={"+":"PLUS","-":"MINUS","*":"MULTIPLY","/":"DIVIDE",".":"PERIOD","\\":"BACKSLASH",":":"COLON","%":"PERCENT","|":"PIPE","!":"EXCLAMATION","?":"QUESTION","#":"POUND","&":"AMPERSAND",$:"DOLLAR",";":"SEMI",",":"COMMA","(":"L_PAREN",")":"R_PAREN","<":"L_ANG",">":"R_ANG","<=":"LTE_ANG",">=":"GTE_ANG","==":"EQ","===":"EQQ","!=":"NEQ","!==":"NEQQ","{":"L_BRACE","}":"R_BRACE","[":"L_BRACKET","]":"R_BRACKET","=":"EQUALS"};function q(e){return A(e)||I(e)||e==="-"||e==="_"||e===":"}function w(e){return A(e)||I(e)||e==="-"||e==="_"||e===":"}function N(e){return e===" "||e==="\t"||b(e)}function O(e){return"[Line: "+e.line+", Column: "+e.col+"]"}function b(e){return e==="\r"||e==="\n"}function I(e){return e>="0"&&e<="9"}function A(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function C(e,r){return e==="_"||!r&&e==="$"}function R(e){return e==="`"||e==="^"}function S(i,o,e){u();var r=null;function u(){while(y(0,true).type==="WHITESPACE"){o.push(i.shift())}}function s(e,r){M.raiseParseError(e,r)}function n(e){var r=l(e);if(r){return r}else{s(this,"Expected '"+e+"' but found '"+k().value+"'")}}function t(e,r,n){for(var t=0;t<arguments.length;t++){var a=arguments[t];var i=l(a);if(i){return i}}}function a(e,r,n){for(var t=0;t<arguments.length;t++){var a=arguments[t];var i=p(a);if(i){return i}}}function l(e){if(k()&&k().op&&k().value===e){return v()}}function c(e,r,n,t){var a=f(e,r,n,t);if(a){return a}else{s(this,"Expected one of "+JSON.stringify([e,r,n]))}}function f(e,r,n,t){if(k()&&k().type&&[e,r,n,t].indexOf(k().type)>=0){return v()}}function m(e,r){var n=p(e,r);if(n){return n}else{s(this,"Expected '"+e+"' but found '"+k().value+"'")}}function p(e,r){var r=r||"IDENTIFIER";if(k()&&k().value===e&&k().type===r){return v()}}function v(){var e=i.shift();o.push(e);r=e;u();return e}function h(e,r){var n=[];var t=y(0,true);while((r==null||t.type!==r)&&(e==null||t.value!==e)&&t.type!=="EOF"){var a=i.shift();o.push(a);n.push(t);t=y(0,true)}u();return n}function d(){if(o[o.length-1]&&o[o.length-1].type==="WHITESPACE"){return o[o.length-1].value}else{return""}}function E(){return h(null,"WHITESPACE")}function T(){return i.length>0}function y(e,r){var n;var t=0;do{if(!r){while(i[t]&&i[t].type==="WHITESPACE"){t++}}n=i[t];e--;t++}while(e>-1);if(n){return n}else{return{type:"EOF",value:"<<<EOF>>>"}}}function k(){return y(0)}function x(){return r}function g(){return e.substring(this.startToken.start,this.endToken.end)}function q(){return e.split("\n")[this.startToken.line-1]}return{matchAnyToken:a,matchAnyOpToken:t,matchOpToken:l,requireOpToken:n,matchTokenType:f,requireTokenType:c,consumeToken:v,matchToken:p,requireToken:m,list:i,consumed:o,source:e,hasMore:T,currentToken:k,lastMatch:x,token:y,consumeUntil:h,consumeUntilWhitespace:E,lastWhitespace:d,sourceFor:g,lineFor:q}}function e(e,r){var n=[];var t=e;var a=0;var i=0;var o=1;var u="<START>";while(a<t.length){if(E()==="-"&&T()==="-"){c()}else{if(N(E())){n.push(x())}else if(!k()&&E()==="."&&A(T())){n.push(f())}else if(!k()&&E()==="#"&&A(T())){n.push(m())}else if(A(E())||C(E(),r)){n.push(p())}else if(I(E())){n.push(v())}else if(E()==='"'||E()==="'"||E()==="`"){n.push(d())}else if(g[E()]){n.push(h())}else if(R(E())){n.push(l("RESERVED",E()))}else{if(a<t.length){throw Error("Unknown token: "+E()+" ")}}}}return S(n,[],t);function s(e,r){var n=l(e,r);n.op=true;return n}function l(e,r){return{type:e,value:r,start:a,end:a+1,column:i,line:o}}function c(){while(E()&&!b(E())){y()}y()}function f(){var e=l("CLASS_REF");var r=y();while(q(E())){r+=y()}e.value=r;e.end=a;return e}function m(){var e=l("ID_REF");var r=y();while(w(E())){r+=y()}e.value=r;e.end=a;return e}function p(){var e=l("IDENTIFIER");var r=y();while(A(E())||C(E())){r+=y()}e.value=r;e.end=a;return e}function v(){var e=l("NUMBER");var r=y();while(I(E())){r+=y()}if(E()==="."){r+=y()}while(I(E())){r+=y()}e.value=r;e.end=a;return e}function h(){var e=s();var r=y();while(E()&&g[r+E()]){r+=y()}e.type=g[r];e.value=r;e.end=a;return e}function d(){var e=l("STRING");var r=y();var n="";while(E()&&E()!==r){if(E()==="\\"){y()}n+=y()}if(E()!==r){throw Error("Unterminated string at "+O(e))}else{y()}e.value=n;e.end=a;e.template=r==="`";return e}function E(){return t.charAt(a)}function T(){return t.charAt(a+1)}function y(){u=E();a++;i++;return u}function k(){return A(u)||I(u)||u===")"||u==="}"||u==="]"}function x(){var e=l("WHITESPACE");var r="";while(E()&&N(E())){if(b(E())){i=0;o++}r+=y()}e.value=r;e.end=a;return e}}return{tokenize:e,makeTokensObject:S}}();var M=function(){var u={};var o={};var s={};var a=[];var l=[];function c(e,r,n){e.startToken=r;e.sourceFor=n.sourceFor;e.lineFor=n.lineFor;e.programSource=n.source}function i(e,r,n){var t=u[e];if(t){var a=r.currentToken();var i=t(M,_,r,n);if(i){c(i,a,r);i.endToken=i.endToken||r.lastMatch();var n=i.root;while(n!=null){c(n,a,r);n=n.root}}return i}}function f(e,r,n,t){var a=i(e,r,t);return a||h(r,n||"Expected "+e)}function m(e,r){for(var n=0;n<e.length;n++){var t=e[n];var a=i(t,r);if(a){return a}}}function n(e,r){u[e]=r}function e(e,a){var i=e+"Command";var r=function(e,r,n){var t=a(e,r,n);if(t){t.type=i;t.execute=function(e){return r.unifiedExec(this,e)};return t}};u[i]=r;o[e]=r}function r(a,i){var o=a+"Feature";var e=function(e,r,n){var t=i(e,r,n);if(t){t.keyword=a;t.type=o;return t}};u[o]=e;s[a]=e}function t(e,r){a.push(e);n(e,r)}function p(e,r){l.push(e);n(e,r)}n("feature",function(e,r,n){if(n.matchOpToken("(")){var t=e.requireElement("feature",n);n.requireOpToken(")");return t}else{var t=s[n.currentToken().value];if(t){return t(e,r,n)}}});n("command",function(e,r,n){if(n.matchOpToken("(")){var t=e.requireElement("command",n);n.requireOpToken(")");return t}else{var t=o[n.currentToken().value];if(t){return t(e,r,n)}else if(n.currentToken().type==="IDENTIFIER"&&n.token(1).value==="("){return e.requireElement("pseudoCommand",n)}}});n("commandList",function(e,r,n){var t=e.parseElement("command",n);if(t){n.matchToken("then");t.next=e.parseElement("commandList",n);return t}});n("leaf",function(e,r,n){var t=m(a,n);if(t==null){return i("symbol",n)}else{return t}});n("indirectExpression",function(e,r,n,t){for(var a=0;a<l.length;a++){var i=l[a];t.endToken=n.lastMatch();var o=e.parseElement(i,n,t);if(o){return o}}return t});n("primaryExpression",function(e,r,n){var t=e.parseElement("leaf",n);if(t){return e.parseElement("indirectExpression",n,t)}e.raiseParseError(n,"Unexpected value: "+n.currentToken().value)});function v(e){var r=e.currentToken();var n=e.source;var t=n.split("\n");var a=r?r.line-1:t.length-1;var i=t[a];var o=r?r.column:i.length-1;return i+"\n"+" ".repeat(o)+"^^\n\n"}function h(e,r){r=(r||"Unexpected Token : "+e.currentToken().value)+"\n\n"+v(e);var n=new Error(r);n["tokens"]=e;throw n}function d(e){return i("hyperscript",e)}function E(e,r){if(e){e.parent=r;E(e.next,r)}}function T(e){return o[e.value]}function y(e){return s[e.value]}function k(e){if(e.value=="end"||e.value=="then"||e.value=="else"||e.value==")"||T(e)||y(e)||e.type=="EOF"){return true}}function x(e){var r=[""];do{r.push(e.lastWhitespace());if(e.currentToken().value==="$"){e.consumeToken();var n=e.matchOpToken("{");r.push(f("expression",e));if(n){e.requireOpToken("}")}r.push("")}else if(e.currentToken().value==="\\"){e.consumeToken();e.consumeToken()}else{var t=e.consumeToken();r[r.length-1]+=t.value}}while(e.hasMore());r.push(e.lastWhitespace());return r}return{setParent:E,requireElement:f,parseElement:i,featureStart:y,commandStart:T,commandBoundary:k,parseAnyOf:m,parseHyperScript:d,raiseParseError:h,addGrammarElement:n,addCommand:e,addFeature:r,addLeafExpression:t,addIndirectExpression:p,parseStringTemplate:x}}();var j={dynamicResolvers:[],String:function(e){if(e.toString){return e.toString()}else{return""+e}},Int:function(e){return parseInt(e)},Float:function(e){return parseFloat(e)},Number:function(e){return Number(e)},Date:function(e){return Date(e)},Array:function(e){return Array.from(e)},JSON:function(e){return JSON.stringify(e)},Object:function(e){if(e instanceof String){e=e.toString()}if(typeof e==="string"){return JSON.parse(e)}else{return c({},e)}}};var _=function(){function n(e,r){var n=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return n&&n.call(e,r)}function i(e,r){var n;if(window.CustomEvent&&typeof window.CustomEvent==="function"){n=new CustomEvent(e,{bubbles:true,cancelable:true,detail:r})}else{n=document.createEvent("CustomEvent");n.initCustomEvent(e,true,true,r)}return n}function o(e,r,n){var n=n||{};n["sentBy"]=e;var t=i(r,n);var a=e.dispatchEvent(t);return a}function u(e){return Array.isArray(e)||e instanceof NodeList}function t(e,r){if(e==null){}else if(u(e)){for(var n=0;n<e.length;n++){r(e[n])}}else{r(e)}}var s={array_sentinel:true};function f(e){var r=[];for(var n=0;n<e.length;n++){var t=e[n];if(Array.isArray(t)){r.push(s);for(var a=0;a<t.length;a++){r.push(t[a])}r.push(s)}else{r.push(t)}}return r}function m(e){var r=[];for(var n=0;n<e.length;n++){var t=e[n];if(t===s){t=e[++n];var a=[];r.push(a);while(t!==s){a.push(t);t=e[++n]}}else{r.push(t)}}return r}function p(e){for(var r=0;r<e.length;r++){var n=e[r];if(n.asyncWrapper){e[r]=n.value}if(Array.isArray(n)){for(var t=0;t<n.length;t++){var a=n[t];if(a.asyncWrapper){n[t]=a.value}}}}}var l={halt_flag:true};function v(r,n){while(true){try{var t=e(r,n)}catch(e){_.registerHyperTrace(n,e);if(n.meta.errorHandler&&!n.meta.handlingError){n.meta.handlingError=true;n[n.meta.errorSymmbol]=e;r=n.meta.errorHandler;continue}else if(n.meta.reject){n.meta.reject(e);t=l}else{throw e}}if(t==null){console.error(r," did not return a next element to execute! context: ",n);return}else if(t.then){t.then(function(e){v(e,n)}).catch(function(e){_.registerHyperTrace(n,e);if(n.meta.errorHandler&&!n.meta.handlingError){n.meta.handlingError=true;n[n.meta.errorSymmbol]=e;v(n.meta.errorHandler,n)}else if(n.meta.reject){n.meta.reject(e)}else{throw e}});return}else if(t===l){return}else{r=t}}}function e(a,r){var e=false;var i=false;var o=[r];if(a.args){for(var n=0;n<a.args.length;n++){var t=a.args[n];if(t==null){o.push(null)}else if(Array.isArray(t)){var u=[];for(var s=0;s<t.length;s++){var l=t[s];var c=l?l.evaluate(r):null;if(c){if(c.then){e=true}else if(c.asyncWrapper){i=true}}u.push(c)}o.push(u)}else if(t.evaluate){var c=t.evaluate(r);if(c){if(c.then){e=true}else if(c.asyncWrapper){i=true}}o.push(c)}else{o.push(t)}}}if(e){return new Promise(function(n,t){var e=f(o);Promise.all(e).then(function(e){e=m(e);if(i){p(e)}try{var r=a.op.apply(a,e);n(r)}catch(e){t(e)}}).catch(function(e){if(r.meta.errorHandler&&!r.meta.handlingError){r.meta.handlingError=true;r[r.meta.errorSymmbol]=e;v(r.meta.errorHandler,r)}else if(r.meta.reject){r.meta.reject(e)}else{}})})}else{if(i){p(o)}return a.op.apply(a,o)}}var r=null;function a(){if(r==null){r=_hyperscript.config.attributes.replace(/ /g,"").split(",")}return r}function c(e){for(var r=0;r<a().length;r++){var n=a()[r];if(e.hasAttribute&&e.hasAttribute(n)){return e.getAttribute(n)}}if(e.type==="text/hyperscript"){return e.innerText}return null}function h(e,r,n,t){var a={meta:{parser:M,lexer:F,runtime:_,owner:e,feature:r,iterators:{}},me:n,event:t,target:t?t.target:null,detail:t?t.detail:null,body:"document"in P?document.body:null};a.meta.ctx=a;return a}function d(){return a().map(function(e){return"["+e+"]"}).join(", ")}function E(e,r){var n=j.dynamicResolvers;for(var t=0;t<n.length;t++){var a=n[t];var i=a(r,e);if(i!==undefined){return i}}if(e==null){return null}var o=j[r];if(o){return o(e)}throw"Unknown conversion : "+r}function T(e,r){return Object.prototype.toString.call(e)==="[object "+r+"]"}function y(e){var r=F.tokenize(e);if(M.commandStart(r.currentToken())){var n=M.parseElement("commandList",r);var t=n;while(t.next){t=t.next}t.next={op:function(){return l}};return n}else if(M.featureStart(r.currentToken())){var a=M.parseElement("hyperscript",r);return a}else{var i=M.parseElement("expression",r);return i}}function k(e,r){r=r||{};var n=y(e);if(n.execute){n.execute(r)}else if(n.apply){n.apply(document.body,null)}else{return n.evaluate(r)}}function x(e){var r=_.getScriptSelector();if(n(e,r)){g(e)}if(e.querySelectorAll){t(e.querySelectorAll(r),function(e){g(e)})}if(e.type==="text/hyperscript"){g(e,document.body)}if(e.querySelectorAll){t(e.querySelectorAll("[type='text/hyperscript']"),function(e){g(e,document.body)})}}function g(r,e){var n=q(r);if(!n.initialized){var t=c(r);if(t){try{n.initialized=true;n.script=t;var a=F.tokenize(t);var i=M.parseHyperScript(a);i.apply(e||r,r);setTimeout(function(){o(e||r,"load")},1)}catch(e){console.error("hyperscript errors were found on the following element:",r,"\n\n",e.message,e.stack)}}}}function q(e){var r="hyperscript-internal-data";var n=e[r];if(!n){n=e[r]={}}return n}function w(e,r,n){if(e==null&&n){return e}var t=Object.prototype.toString.call(e).slice(8,-1);var a=e&&t===r;if(a){return e}else{throw new Error("Typecheck failed!  Expected: "+r+", Found: "+t)}}function N(e,r){if(e==="me"||e==="my"||e==="I"){return r["me"]}if(e==="it"||e==="its"){return r["result"]}else{if(r.meta&&r.meta.context){var n=r.meta.context[e];if(typeof n!=="undefined"){return n}}var t=r[e];if(typeof t!=="undefined"){return t}else{return P[e]}}}function O(e,r){if(e){if(e.resolveNext){return e.resolveNext(r)}else if(e.next){return e.next}else{return O(e.parent,r)}}}function b(e,r){if(e!=null){var n=e[r];if(typeof n!=="undefined"){return n}else{if(u(e)){if(r==="first"){return e[0]}else if(r==="last"){return e[e.length-1]}else if(r==="random"){return e[Math.floor(e.length*Math.random())]}else{var t=[];for(var a=0;a<e.length;a++){var i=e[a];var o=i[r];if(o){t.push(o)}}return t}}}}}function I(e,r,n){var t=P;while(e.length>0){var a=e.shift();var i=t[a];if(i==null){i={};t[a]=i}t=i}t[r]=n}function A(e,r){var n=[];var t=e;while(t.meta.caller){t=t.meta.caller}if(t.meta.traceMap){return t.meta.traceMap.get(r,n)}}function C(e,r){var a=[];var n=null;while(e!=null){a.push(e);n=e;e=e.meta.caller}if(n.meta.traceMap==null){n.meta.traceMap=new Map}if(!n.meta.traceMap.get(r)){var t={trace:a,print:function(e){e=e||console.error;e("hypertrace /// ");var r=0;for(var n=0;n<a.length;n++){r=Math.max(r,a[n].meta.feature.displayName.length)}for(var n=0;n<a.length;n++){var t=a[n];e("  ->",t.meta.feature.displayName.padEnd(r+2),"-",t.meta.owner)}}};n.meta.traceMap.set(r,t)}}function R(e){return e.replace(/:/g,function(e){return"\\"+e})}function S(e,r){if(e==null){throw new Error(r.sourceFor()+" is null")}}var L="document"in P?document.currentScript.src:null;return{typeCheck:w,forEach:t,triggerEvent:o,matchesSelector:n,getScript:c,processNode:x,evaluate:k,parse:y,getScriptSelector:d,resolveSymbol:N,makeContext:h,findNext:O,unifiedEval:e,convertValue:E,unifiedExec:v,resolveProperty:b,assignToNamespace:I,registerHyperTrace:C,getHyperTrace:A,getInternalData:q,escapeSelector:R,nullCheck:S,hyperscriptUrl:L,HALT:l}}();{M.addLeafExpression("parenthesized",function(e,r,n){if(n.matchOpToken("(")){var t=e.requireElement("expression",n);n.requireOpToken(")");return{type:"parenthesized",expr:t,evaluate:function(e){return t.evaluate(e)}}}});M.addLeafExpression("string",function(e,r,n){var t=n.matchTokenType("STRING");if(t){var a=t.value;if(t.template){var i=F.tokenize(a,true);var o=e.parseStringTemplate(i)}else{var o=[]}return{type:"string",token:t,args:o,op:function(e){var r="";for(var n=1;n<arguments.length;n++){var t=arguments[n];if(t){r+=t}}return r},evaluate:function(e){if(o.length===0){return a}else{return r.unifiedEval(this,e)}}}}});M.addGrammarElement("nakedString",function(e,r,n){if(n.hasMore()){var t=n.consumeUntilWhitespace();n.matchTokenType("WHITESPACE");return{type:"nakedString",tokens:t,evaluate:function(e){return t.map(function(e){return e.value}).join("")}}}});M.addLeafExpression("number",function(e,r,n){var t=n.matchTokenType("NUMBER");if(t){var a=t;var i=parseFloat(t.value);return{type:"number",value:i,numberToken:a,evaluate:function(){return i}}}});M.addLeafExpression("idRef",function(e,r,n){var t=n.matchTokenType("ID_REF");if(t){return{type:"idRef",css:t.value,value:t.value.substr(1),evaluate:function(e){return document.getElementById(this.value)}}}});M.addLeafExpression("classRef",function(e,r,n){var t=n.matchTokenType("CLASS_REF");if(t){return{type:"classRef",css:t.value,className:function(){return this.css.substr(1)},evaluate:function(){return document.querySelectorAll(r.escapeSelector(this.css))}}}});M.addLeafExpression("queryRef",function(e,r,n){var t=n.matchOpToken("<");if(t){var a=n.consumeUntil("/");n.requireOpToken("/");n.requireOpToken(">");var i=a.map(function(e){if(e.type==="STRING"){return'"'+e.value+'"'}else{return e.value}}).join("");return{type:"queryRef",css:i,evaluate:function(){return document.querySelectorAll(this.css)}}}});M.addGrammarElement("attributeRef",function(e,r,n){if(n.matchOpToken("[")){var t=n.consumeUntil("]");var a=t.map(function(e){return e.value}).join("");var i=a.split("=");var o=i[0];var u=i[1];n.requireOpToken("]");return{type:"attribute_expression",name:o,value:u,args:[u],op:function(e,r){if(this.value){return{name:this.name,value:r}}else{return{name:this.name}}},evaluate:function(e){return r.unifiedEval(this,e)}}}});M.addGrammarElement("objectKey",function(e,r,n){var t;if(t=n.matchTokenType("STRING")){return{type:"objectKey",key:t.value,evaluate:function(){return this.key}}}else if(n.matchOpToken("[")){var a=e.parseElement("expression",n);n.requireOpToken("]");return{type:"objectKey",expr:a,args:[a],op:function(e,r){return r},evaluate:function(e){return r.unifiedEval(this,e)}}}else{var i="";do{t=n.matchTokenType("IDENTIFIER")||n.matchOpToken("-");if(t)i+=t.value}while(t);return{type:"objectKey",key:i,evaluate:function(){return this.key}}}});M.addLeafExpression("objectLiteral",function(e,r,n){if(n.matchOpToken("{")){var t=[];var a=[];if(!n.matchOpToken("}")){do{var i=e.requireElement("objectKey",n);n.requireOpToken(":");var o=e.requireElement("expression",n);a.push(o);t.push(i)}while(n.matchOpToken(","));n.requireOpToken("}")}return{type:"objectLiteral",args:[t,a],op:function(e,r,n){var t={};for(var a=0;a<r.length;a++){t[r[a]]=n[a]}return t},evaluate:function(e){return r.unifiedEval(this,e)}}}});M.addGrammarElement("namedArgumentList",function(e,r,n){if(n.matchOpToken("(")){var i=[];var t=[];if(!n.matchOpToken(")")){do{var a=n.requireTokenType("IDENTIFIER");n.requireOpToken(":");var o=e.requireElement("expression",n);t.push(o);i.push({name:a,value:o})}while(n.matchOpToken(","));n.requireOpToken(")")}return{type:"namedArgumentList",fields:i,args:[t],op:function(e,r){var n={_namedArgList_:true};for(var t=0;t<r.length;t++){var a=i[t];n[a.name.value]=r[t]}return n},evaluate:function(e){return r.unifiedEval(this,e)}}}});M.addGrammarElement("symbol",function(e,r,n){var t=n.matchTokenType("IDENTIFIER");if(t){return{type:"symbol",token:t,name:t.value,evaluate:function(e){return r.resolveSymbol(t.value,e)}}}});M.addGrammarElement("implicitMeTarget",function(e,r,n){return{type:"implicitMeTarget",evaluate:function(e){return e.me}}});M.addLeafExpression("boolean",function(e,r,n){var t=n.matchToken("true")||n.matchToken("false");if(t){return{type:"boolean",evaluate:function(e){return t.value==="true"}}}});M.addLeafExpression("null",function(e,r,n){if(n.matchToken("null")){return{type:"null",evaluate:function(e){return null}}}});M.addLeafExpression("arrayLiteral",function(e,r,n){if(n.matchOpToken("[")){var t=[];if(!n.matchOpToken("]")){do{var a=e.requireElement("expression",n);t.push(a)}while(n.matchOpToken(","));n.requireOpToken("]")}return{type:"arrayLiteral",values:t,args:[t],op:function(e,r){return r},evaluate:function(e){return r.unifiedEval(this,e)}}}});M.addLeafExpression("blockLiteral",function(e,r,n){if(n.matchOpToken("\\")){var t=[];var a=n.matchTokenType("IDENTIFIER");if(a){t.push(a);while(n.matchOpToken(",")){t.push(n.requireTokenType("IDENTIFIER"))}}n.requireOpToken("-");n.requireOpToken(">");var i=e.requireElement("expression",n);return{type:"blockLiteral",args:t,expr:i,evaluate:function(r){var e=function(){for(var e=0;e<t.length;e++){r[t[e].value]=arguments[e]}return i.evaluate(r)};return e}}}});M.addGrammarElement("timeExpression",function(e,r,n){var t=e.requireElement("expression",n);var a=1;if(n.matchToken("s")||n.matchToken("seconds")){a=1e3}else if(n.matchToken("ms")||n.matchToken("milliseconds")){}return{type:"timeExpression",time:t,factor:a,args:[t],op:function(e,r){return r*this.factor},evaluate:function(e){return r.unifiedEval(this,e)}}});M.addIndirectExpression("propertyAccess",function(e,t,r,n){if(r.matchOpToken(".")){var a=r.requireTokenType("IDENTIFIER");var i={type:"propertyAccess",root:n,prop:a,args:[n],op:function(e,r){var n=t.resolveProperty(r,a.value);return n},evaluate:function(e){return t.unifiedEval(this,e)}};return e.parseElement("indirectExpression",r,i)}});M.addIndirectExpression("of",function(e,n,r,t){if(r.matchToken("of")){var a=e.requireElement("expression",r);var i=null;var o=t;while(o.root){i=o;o=o.root}if(o.type!=="symbol"){e.raiseParseError(r,"Cannot take a property of a non-symbol")}var u=o.name;var s={type:"ofExpression",prop:o.token,root:a,expression:t,args:[a],op:function(e,r){return n.resolveProperty(r,u)},evaluate:function(e){return n.unifiedEval(this,e)}};if(i){i.root=s;i.args=[s]}else{t=s}return e.parseElement("indirectExpression",r,t)}});M.addIndirectExpression("inExpression",function(e,a,r,i){if(r.matchToken("in")){if(i.type!=="idRef"&&i.type==="queryRef"||i.type==="classRef"){var o=true}var n=e.requireElement("expression",r);var t={type:"inExpression",root:i,args:[o?null:i,n],op:function(e,r,n){var t=[];if(o){a.forEach(n,function(e){var r=e.querySelectorAll(i.css);for(var n=0;n<r.length;n++){t.push(r[n])}})}else{a.forEach(r,function(r){a.forEach(n,function(e){if(r===e){t.push(r)}})})}if(t.length>0){return t}else{return null}},evaluate:function(e){return a.unifiedEval(this,e)}};return e.parseElement("indirectExpression",r,t)}});M.addIndirectExpression("asExpression",function(e,n,r,t){if(r.matchToken("as")){var a=e.requireElement("dotOrColonPath",r).evaluate();var i={type:"asExpression",root:t,args:[t],op:function(e,r){return n.convertValue(r,a)},evaluate:function(e){return n.unifiedEval(this,e)}};return e.parseElement("indirectExpression",r,i)}});M.addIndirectExpression("functionCall",function(e,a,r,i){if(r.matchOpToken("(")){var n=[];if(!r.matchOpToken(")")){do{n.push(e.requireElement("expression",r))}while(r.matchOpToken(","));r.requireOpToken(")")}if(i.root){var t={type:"functionCall",root:i,argExressions:n,args:[i.root,n],op:function(e,r,n){a.nullCheck(r,i.root);var t=r[i.prop.value];a.nullCheck(t,i);if(t.hyperfunc){n.push(e)}return t.apply(r,n)},evaluate:function(e){return a.unifiedEval(this,e)}}}else{var t={type:"functionCall",root:i,argExressions:n,args:[i,n],op:function(e,r,n){a.nullCheck(r,i);if(r.hyperfunc){n.push(e)}var t=r.apply(null,n);return t},evaluate:function(e){return a.unifiedEval(this,e)}}}return e.parseElement("indirectExpression",r,t)}});M.addIndirectExpression("arrayIndex",function(e,r,n,t){if(n.matchOpToken("[")){var a=e.requireElement("expression",n);n.requireOpToken("]");var i={type:"arrayIndex",root:t,index:a,args:[t,a],op:function(e,r,n){return r[n]},evaluate:function(e){return _.unifiedEval(this,e)}};return M.parseElement("indirectExpression",n,i)}});M.addGrammarElement("postfixExpression",function(e,n,r){var t=e.parseElement("primaryExpression",r);if(r.matchOpToken(":")){var a=r.requireTokenType("IDENTIFIER");var i=!r.matchOpToken("!");return{type:"typeCheck",typeName:a,root:t,nullOk:i,args:[t],op:function(e,r){return n.typeCheck(r,this.typeName.value,this.nullOk)},evaluate:function(e){return n.unifiedEval(this,e)}}}else{return t}});M.addGrammarElement("logicalNot",function(e,r,n){if(n.matchToken("not")){var t=e.requireElement("unaryExpression",n);return{type:"logicalNot",root:t,args:[t],op:function(e,r){return!r},evaluate:function(e){return r.unifiedEval(this,e)}}}});M.addGrammarElement("noExpression",function(e,r,n){if(n.matchToken("no")){var t=e.requireElement("unaryExpression",n);return{type:"noExpression",root:t,args:[t],op:function(e,r){return r==null||r.length===0},evaluate:function(e){return r.unifiedEval(this,e)}}}});M.addGrammarElement("negativeNumber",function(e,r,n){if(n.matchOpToken("-")){var t=e.requireElement("unaryExpression",n);return{type:"negativeNumber",root:t,args:[t],op:function(e,r){return-1*r},evaluate:function(e){return r.unifiedEval(this,e)}}}});M.addGrammarElement("unaryExpression",function(e,r,n){return e.parseAnyOf(["logicalNot","positionalExpression","noExpression","negativeNumber","postfixExpression"],n)});M.addGrammarElement("positionalExpression",function(e,r,n){var t=n.matchAnyToken("first","last","random");if(t){n.matchAnyToken("in","from","of");var a=e.requireElement("unaryExpression",n);return{type:"positionalExpression",rhs:a,operator:t.value,args:[a],op:function(e,r){if(!Array.isArray(r)){if(r.children){r=r.children}else{r=Array.from(r)}}if(this.operator==="first"){return r[0]}else if(this.operator==="last"){return r[r.length-1]}else if(this.operator==="random"){return r[Math.floor(Math.random()*r.length)]}},evaluate:function(e){return r.unifiedEval(this,e)}}}});M.addGrammarElement("mathOperator",function(e,r,n){var t=e.parseElement("unaryExpression",n);var a,i=null;a=n.matchAnyOpToken("+","-","*","/","%");while(a){i=i||a;var o=a.value;if(i.value!==o){e.raiseParseError(n,"You must parenthesize math operations with different operators")}var u=e.parseElement("unaryExpression",n);t={type:"mathOperator",lhs:t,rhs:u,operator:o,args:[t,u],op:function(e,r,n){if(this.operator==="+"){return r+n}else if(this.operator==="-"){return r-n}else if(this.operator==="*"){return r*n}else if(this.operator==="/"){return r/n}else if(this.operator==="%"){return r%n}},evaluate:function(e){return r.unifiedEval(this,e)}};a=n.matchAnyOpToken("+","-","*","/","%")}return t});M.addGrammarElement("mathExpression",function(e,r,n){return e.parseAnyOf(["mathOperator","unaryExpression"],n)});M.addGrammarElement("comparisonOperator",function(e,r,n){var t=e.parseElement("mathExpression",n);var a=n.matchAnyOpToken("<",">","<=",">=","==","===","!=","!==");var i=a?a.value:null;if(i==null){if(n.matchToken("is")||n.matchToken("am")){if(n.matchToken("not")){if(n.matchToken("in")){i="not in"}else{i="!="}}else{if(n.matchToken("in")){i="in"}else{i="=="}}}else if(n.matchToken("matches")||n.matchToken("match")){i="match"}else if(n.matchToken("contains")||n.matchToken("contain")){i="contain"}else if(n.matchToken("do")||n.matchToken("does")){n.requireToken("not");if(n.matchToken("matches")||n.matchToken("match")){i="not match"}else if(n.matchToken("contains")||n.matchToken("contain")){i="not contain"}else{e.raiseParseError(n,"Expected matches or contains")}}}if(i){var o=e.requireElement("mathExpression",n);if(i==="match"||i==="not match"){o=o.css?o.css:o}t={type:"comparisonOperator",operator:i,lhs:t,rhs:o,args:[t,o],op:function(e,r,n){if(this.operator==="=="){return r==n}else if(this.operator==="!="){return r!=n}if(this.operator==="in"){return n!=null&&Array.from(n).indexOf(r)>=0}if(this.operator==="not in"){return n==null||Array.from(n).indexOf(r)<0}if(this.operator==="match"){return r!=null&&r.matches(n)}if(this.operator==="not match"){return r==null||!r.matches(n)}if(this.operator==="contain"){return r!=null&&r.contains(n)}if(this.operator==="not contain"){return r==null||!r.contains(n)}if(this.operator==="==="){return r===n}else if(this.operator==="!=="){return r!==n}else if(this.operator==="<"){return r<n}else if(this.operator===">"){return r>n}else if(this.operator==="<="){return r<=n}else if(this.operator===">="){return r>=n}},evaluate:function(e){return r.unifiedEval(this,e)}}}return t});M.addGrammarElement("comparisonExpression",function(e,r,n){return e.parseAnyOf(["comparisonOperator","mathExpression"],n)});M.addGrammarElement("logicalOperator",function(e,r,n){var t=e.parseElement("comparisonExpression",n);var a,i=null;a=n.matchToken("and")||n.matchToken("or");while(a){i=i||a;if(i.value!==a.value){e.raiseParseError(n,"You must parenthesize logical operations with different operators")}var o=e.requireElement("comparisonExpression",n);t={type:"logicalOperator",operator:a.value,lhs:t,rhs:o,args:[t,o],op:function(e,r,n){if(this.operator==="and"){return r&&n}else{return r||n}},evaluate:function(e){return r.unifiedEval(this,e)}};a=n.matchToken("and")||n.matchToken("or")}return t});M.addGrammarElement("logicalExpression",function(e,r,n){return e.parseAnyOf(["logicalOperator","mathExpression"],n)});M.addGrammarElement("asyncExpression",function(e,r,n){if(n.matchToken("async")){var t=e.requireElement("logicalExpression",n);var a={type:"asyncExpression",value:t,evaluate:function(e){return{asyncWrapper:true,value:this.value.evaluate(e)}}};return a}else{return e.parseElement("logicalExpression",n)}});M.addGrammarElement("expression",function(e,r,n){n.matchToken("the");return e.parseElement("asyncExpression",n)});M.addGrammarElement("targetExpression",function(e,r,n){n.matchToken("the");var t=e.parseElement("primaryExpression",n);if(t.type==="symbol"||t.type==="idRef"||t.type==="inExpression"||t.type==="queryRef"||t.type==="classRef"||t.type==="ofExpression"||t.type==="propertyAccess"){return t}else{M.raiseParseError(n,"A target expression must be writable")}return t});M.addGrammarElement("hyperscript",function(e,r,n){var t=[];if(n.hasMore()){do{var a=e.requireElement("feature",n);t.push(a);n.matchToken("end")}while(e.featureStart(n.currentToken())||n.currentToken().value==="(");if(n.hasMore()){e.raiseParseError(n)}}return{type:"hyperscript",features:t,apply:function(r,n){_.forEach(t,function(e){e.install(r,n)})}}});M.addFeature("on",function(e,u,r){if(r.matchToken("on")){var n=false;if(r.matchToken("every")){n=true}var t=[];var a=null;do{var i=e.requireElement("dotOrColonPath",r,"Expected event name");var o=i.evaluate();if(a){a=a+" or "+o}else{a="on "+o}var s=[];if(r.token(0).value==="("&&(r.token(1).value===")"||r.token(2).value===","||r.token(2).value===")")){r.matchOpToken("(");do{s.push(r.requireTokenType("IDENTIFIER"))}while(r.matchOpToken(","));r.requireOpToken(")")}var l=null;if(r.matchOpToken("[")){l=e.requireElement("expression",r);r.requireOpToken("]")}if(r.currentToken().type==="NUMBER"){var c=r.consumeToken();var f=parseInt(c.value);if(r.matchToken("to")){var m=r.consumeToken();var p=parseInt(m.value)}else if(r.matchToken("and")){var v=true;r.requireToken("on")}}var h=null;var d=false;if(r.matchToken("from")){if(r.matchToken("elsewhere")){d=true}else{h=e.parseElement("targetExpression",r);if(!h){e.raiseParseError('Expected either target value or "elsewhere".',r)}}}if(h===null&&d===false&&r.matchToken("elsewhere")){d=true}if(r.matchToken("in")){var E=e.parseAnyOf(["idRef","queryRef","classRef"],r)}if(r.matchToken("debounced")){r.requireToken("at");var T=e.requireElement("timeExpression",r);var y=T.evaluate({})}else if(r.matchToken("throttled")){r.requireToken("at");var T=e.requireElement("timeExpression",r);var k=T.evaluate({})}t.push({execCount:0,every:n,on:o,args:s,filter:l,from:h,inExpr:E,elsewhere:d,startCount:f,endCount:p,unbounded:v,debounceTime:y,throttleTime:k})}while(r.matchToken("or"));var x=[];var g=true;if(!n){if(r.matchToken("queue")){if(r.matchToken("all")){var q=true;var g=false}else if(r.matchToken("first")){var w=true}else if(r.matchToken("none")){var N=true}else{r.requireToken("last")}}}var O=e.requireElement("commandList",r);var b={type:"implicitReturn",op:function(e){e.meta.resolve();return u.HALT},execute:function(e){}};if(O){var I=O;while(I.next){I=I.next}I.next=b}else{O=b}var A={displayName:a,events:t,start:O,every:n,executing:false,execCount:0,queue:x,execute:function(t){if(this.executing&&this.every===false){if(N||w&&x.length>0){return}if(g){A.queue.length=0}A.queue.push(t);return}this.execCount++;this.executing=true;t.meta.resolve=function(){A.executing=false;var e=A.queue.shift();if(e){setTimeout(function(){A.execute(e)},1)}};t.meta.reject=function(e){console.error(e.message?e.message:e);var r=u.getHyperTrace(t,e);if(r){r.print()}u.triggerEvent(t.me,"exception",{error:e});A.executing=false;var n=A.queue.shift();if(n){setTimeout(function(){A.execute(n)},1)}};O.execute(t)},install:function(o,e){u.forEach(A.events,function(i){var e;if(i.elsewhere){e=[document]}else if(i.from){e=i.from.evaluate({})}else{e=[o]}u.forEach(e,function(e){e.addEventListener(i.on,function(e){var r=u.makeContext(o,A,o,e);if(i.elsewhere&&o.contains(e.target)){return}u.forEach(i.args,function(e){r[e.value]=r.event[e.value]||(r.event.detail?r.event.detail[e.value]:null)});if(i.filter){var n=r.meta.context;r.meta.context=r.event;try{var t=i.filter.evaluate(r);if(t){}else{return}}finally{r.meta.context=n}}if(i.inExpr){var a=e.target;while(true){if(a.matches&&a.matches(i.inExpr.css)){r.result=a;break}else{a=a.parentElement;if(a==null){return}}}}i.execCount++;if(i.startCount){if(i.endCount){if(i.execCount<i.startCount||i.execCount>i.endCount){return}}else if(i.unbounded){if(i.execCount<i.startCount){return}}else if(i.execCount!==i.startCount){return}}if(i.debounceTime){if(i.debounced){clearTimeout(i.debounced)}i.debounced=setTimeout(function(){A.execute(r)},i.debounceTime);return}if(i.throttleTime){if(i.lastExec&&Date.now()<i.lastExec+i.throttleTime){return}else{i.lastExec=Date.now()}}A.execute(r)})})})}};e.setParent(O,A);return A}});M.addFeature("def",function(e,l,r){if(r.matchToken("def")){var n=e.requireElement("dotOrColonPath",r);var t=n.evaluate();var a=t.split(".");var i=a.pop();var c=[];if(r.matchOpToken("(")){if(r.matchOpToken(")")){}else{do{c.push(r.requireTokenType("IDENTIFIER"))}while(r.matchOpToken(","));r.requireOpToken(")")}}var f=e.parseElement("commandList",r);if(r.matchToken("catch")){var m=r.requireTokenType("IDENTIFIER").value;var p=e.parseElement("commandList",r)}var v={displayName:i+"("+c.map(function(e){return e.value}).join(", ")+")",name:i,args:c,start:f,errorHandler:p,errorSymbol:m,install:function(e,s){var r=function(){var e="document"in P?document.body:P;var r=l.makeContext(s,v,e,null);r.meta.errorHandler=p;r.meta.errorSymmbol=m;for(var n=0;n<c.length;n++){var t=c[n];var a=arguments[n];if(t){r[t.value]=a}}r.meta.caller=arguments[c.length];var i,o=null;var u=new Promise(function(e,r){i=e;o=r});f.execute(r);if(r.meta.returned){return r.meta.returnValue}else{r.meta.resolve=i;r.meta.reject=o;return u}};r.hyperfunc=true;l.assignToNamespace(a,i,r)}};var o={type:"implicitReturn",op:function(e){e.meta.returned=true;if(e.meta.resolve){e.meta.resolve()}return l.HALT},execute:function(e){}};if(f){var u=f;while(u.next){u=u.next}u.next=o}else{v.start=o}if(p){var u=p;while(u.next){u=u.next}u.next=o}e.setParent(f,v);return v}});M.addFeature("init",function(e,n,r){if(r.matchToken("init")){var t=e.parseElement("commandList",r);var a={start:t,install:function(e,r){setTimeout(function(){t.execute(n.makeContext(e,this,e))},0)}};var i={type:"implicitReturn",op:function(e){return n.HALT},execute:function(e){}};if(t){var o=t;while(o.next){o=o.next}o.next=i}else{a.start=i}e.setParent(t,a);return a}});M.addFeature("worker",function(e,r,n){if(n.matchToken("worker")){e.raiseParseError(n,"In order to use the 'worker' feature, include "+"the _hyperscript worker plugin. See "+"https://hyperscript.org/features/worker/ for "+"more info.")}});M.addGrammarElement("jsBody",function(e,r,n){var t=n.currentToken().start;var a=n.currentToken();var i=[];var o="";var u=false;while(n.hasMore()){a=n.consumeToken();var s=n.currentToken(true);if(s.type==="IDENTIFIER"&&s.value==="end"){break}if(u){if(a.type==="IDENTIFIER"||a.type==="NUMBER"){o+=a.value}else{if(o!=="")i.push(o);o="";u=false}}else if(a.type==="IDENTIFIER"&&a.value==="function"){u=true}}var l=a.end+1;return{type:"jsBody",exposedFunctionNames:i,jsSource:n.source.substring(t,l)}});M.addFeature("js",function(e,r,n){if(n.matchToken("js")){var t=e.parseElement("jsBody",n);var a=t.jsSource+"\nreturn { "+t.exposedFunctionNames.map(function(e){return e+":"+e}).join(",")+" } ";var i=new Function(a);return{jsSource:a,function:i,exposedFunctionNames:t.exposedFunctionNames,install:function(){c(P,i())}}}});M.addCommand("js",function(e,t,r){if(r.matchToken("js")){var a=[];if(r.matchOpToken("(")){if(r.matchOpToken(")")){}else{do{var n=r.requireTokenType("IDENTIFIER");a.push(n.value)}while(r.matchOpToken(","));r.requireOpToken(")")}}var i=e.parseElement("jsBody",r);r.matchToken("end");var o=u(Function,a.concat([i.jsSource]));return{jsSource:i.jsSource,function:o,inputs:a,op:function(n){var r=[];a.forEach(function(e){r.push(t.resolveSymbol(e,n))});var e=o.apply(P,r);if(e&&typeof e.then==="function"){return Promise(function(r){e.then(function(e){n.result=e;r(t.findNext(this,n))})})}else{n.result=e;return t.findNext(this,n)}}}}});M.addCommand("async",function(e,r,n){if(n.matchToken("async")){if(n.matchToken("do")){var t=e.requireElement("commandList",n);n.requireToken("end")}else{var t=e.requireElement("command",n)}return{body:t,op:function(e){setTimeout(function(){t.execute(e)});return r.findNext(this,e)}}}});M.addCommand("with",function(e,n,r){var t=r.currentToken();if(r.matchToken("with")){var a=e.requireElement("expression",r);var i=e.requireElement("commandList",r);if(r.hasMore()){r.requireToken("end")}var o="with_"+t.start;var u={value:a,body:i,args:[a],resolveNext:function(e){var r=e.meta.iterators[o];if(r.index<r.value.length){e.me=r.value[r.index++];return i}else{e.me=r.originalMe;if(this.next){return this.next}else{return n.findNext(this.parent,e)}}},op:function(e,r){if(r==null){r=[]}else if(!(Array.isArray(r)||r instanceof NodeList)){r=[r]}e.meta.iterators[o]={originalMe:e.me,index:0,value:r};return this.resolveNext(e)}};e.setParent(i,u);return u}});M.addCommand("wait",function(e,i,r){if(r.matchToken("wait")){if(r.matchToken("for")){r.matchToken("a");var n=M.requireElement("dotOrColonPath",r,"Expected event name");if(r.matchToken("from")){var t=e.requireElement("expression",r)}var o={event:n,on:t,args:[n,t],op:function(n,t,e){var a=e?e:n.me;return new Promise(function(e){var r=function(){e(i.findNext(o,n))};a.addEventListener(t,r,{once:true})})}}}else{if(r.matchToken("a")){r.requireToken("tick");a=0}else{var a=M.requireElement("timeExpression",r)}var o={type:"waitCmd",time:a,args:[a],op:function(r,n){return new Promise(function(e){setTimeout(function(){e(i.findNext(o,r))},n)})},execute:function(e){return i.unifiedExec(this,e)}}}return o}});M.addGrammarElement("dotOrColonPath",function(e,r,n){var t=n.matchTokenType("IDENTIFIER");if(t){var a=[t.value];var i=n.matchOpToken(".")||n.matchOpToken(":");if(i){do{a.push(n.requireTokenType("IDENTIFIER").value)}while(n.matchOpToken(i.value))}return{type:"dotOrColonPath",path:a,evaluate:function(){return a.join(i?i.value:"")}}}});M.addCommand("send",function(e,a,r){if(r.matchToken("send")){var n=e.requireElement("dotOrColonPath",r);var t=e.parseElement("namedArgumentList",r);if(r.matchToken("to")){var i=e.requireElement("targetExpression",r)}else{var i=e.requireElement("implicitMeTarget",r)}var o={eventName:n,details:t,to:i,args:[i,n,t],op:function(e,r,n,t){a.forEach(r,function(e){a.triggerEvent(e,n,t?t:{})});return a.findNext(o,e)}};return o}});M.addCommand("return",function(e,t,r){if(r.matchToken("return")){var n=e.requireElement("expression",r);var a={value:n,args:[n],op:function(e,r){var n=e.meta.resolve;e.meta.returned=true;if(n){if(r){n(r)}else{n()}}else{e.meta.returned=true;e.meta.returnValue=r}return t.HALT}};return a}});M.addCommand("log",function(e,t,r){if(r.matchToken("log")){var n=[e.parseElement("expression",r)];while(r.matchOpToken(",")){n.push(e.requireElement("expression",r))}if(r.matchToken("with")){var a=e.requireElement("expression",r)}var i={exprs:n,withExpr:a,args:[a,n],op:function(e,r,n){if(r){r.apply(null,n)}else{console.log.apply(null,n)}return t.findNext(this,e)}};return i}});M.addCommand("throw",function(e,t,r){if(r.matchToken("throw")){var n=e.requireElement("expression",r);var a={expr:n,args:[n],op:function(e,r){t.registerHyperTrace(e,r);var n=e.meta&&e.meta.reject;if(n){n(r);return t.HALT}else{throw r}}};return a}});var a=function(e,n,r){var t=e.requireElement("expression",r);var a={expr:t,args:[t],op:function(e,r){e.result=r;return n.findNext(a,e)}};return a};M.addCommand("call",function(e,r,n){if(n.matchToken("call")){var t=a(e,r,n);if(t.expr&&t.expr.type!=="functionCall"){e.raiseParseError(n,"Must be a function invocation")}return t}});M.addCommand("get",function(e,r,n){if(n.matchToken("get")){return a(e,r,n)}});M.addGrammarElement("pseudoCommand",function(e,i,r){var n=e.requireElement("primaryExpression",r);if(n.type!=="functionCall"&&n.root.type!=="symbol"){e.raiseParseError("Implicit function calls must start with a simple function",r)}if(!r.matchAnyToken("to","on","with")&&e.commandBoundary(r.currentToken())){var t=e.requireElement("implicitMeTarget",r)}else{var t=e.requireElement("expression",r)}var o=n.root.name;var a=n.argExressions;var u={type:"pseudoCommand",expr:n,args:[t,a],op:function(e,r,n){var t=r[o];if(t.hyperfunc){n.push(e)}var a=t.apply(r,n);e.result=a;return i.findNext(u,e)},execute:function(e){return i.unifiedExec(this,e)}};return u});M.addCommand("set",function(e,t,r){if(r.matchToken("set")){if(r.currentToken().type==="L_BRACE"){var n=e.requireElement("objectLiteral",r);r.requireToken("on");var a=e.requireElement("expression",r);return{objectLiteral:n,target:a,args:[n,a],op:function(e,r,n){c(n,r)}}}var a=e.requireElement("targetExpression",r);r.requireToken("to");var i=e.requireElement("expression",r);var o=a.type==="symbol";if(a.type!=="symbol"&&a.root==null){e.raiseParseError(r,"Can only put directly into symbols, not references")}var u=null;var s=null;if(o){}else{s=a.prop.value;u=a.root}var l={target:a,symbolWrite:o,value:i,args:[u,i],op:function(e,r,n){if(o){e[a.name]=n}else{t.forEach(r,function(e){e[s]=n})}return t.findNext(this,e)}};return l}});M.addCommand("if",function(e,n,r){if(r.matchToken("if")){var t=e.requireElement("expression",r);r.matchToken("then");var a=e.parseElement("commandList",r);if(r.matchToken("else")){var i=e.parseElement("commandList",r)}if(r.hasMore()){r.requireToken("end")}var o={expr:t,trueBranch:a,falseBranch:i,args:[t],op:function(e,r){if(r){return a}else if(i){return i}else{return n.findNext(this,e)}}};e.setParent(a,o);e.setParent(i,o);return o}});var t=function(e,r,a,n){var t=r.currentToken();if(r.matchToken("for")||n){var i=r.requireTokenType("IDENTIFIER");var o=i.value;r.requireToken("in");var u=e.requireElement("expression",r)}else if(r.matchToken("in")){var o="it";var u=e.requireElement("expression",r)}else if(r.matchToken("while")){var s=e.requireElement("expression",r)}else if(r.matchToken("until")){var l=true;if(r.matchToken("event")){var c=M.requireElement("dotOrColonPath",r,"Expected event name");if(r.matchToken("from")){var f=e.requireElement("expression",r)}}else{var s=e.requireElement("expression",r)}}else if(r.matchTokenType("NUMBER")){var m=parseFloat(t.value);r.requireToken("times")}else{r.matchToken("forever");var p=true}if(r.matchToken("index")){var i=r.requireTokenType("IDENTIFIER");var v=i.value}var h=e.parseElement("commandList",r);if(r.hasMore()){r.requireToken("end")}if(o==null){o="_implicit_repeat_"+t.start;var d=o}else{var d=o+"_"+t.start}var E={identifier:o,indexIdentifier:v,slot:d,expression:u,forever:p,times:m,until:l,event:c,on:f,whileExpr:s,resolveNext:function(){return this},loop:h,args:[s],op:function(e,r){var n=e.meta.iterators[d];var t=false;if(this.forever){t=true}else if(this.until){if(c){t=e.meta.iterators[d].eventFired===false}else{t=r!==true}}else if(r){t=true}else if(m){t=n.index<this.times}else{t=n.value!==null&&n.index<n.value.length}if(t){if(n.value){e[o]=n.value[n.index];e.result=n.value[n.index]}else{e.result=n.index}if(v){e[v]=n.index}n.index++;return h}else{e.meta.iterators[d]=null;return a.findNext(this.parent,e)}}};e.setParent(h,E);var T={name:"repeatInit",args:[u,c,f],op:function(r,e,n,t){r.meta.iterators[d]={index:0,value:e,eventFired:false};if(c){var a=t||r.me;a.addEventListener(n,function(e){r.meta.iterators[d].eventFired=true},{once:true})}return E},execute:function(e){return a.unifiedExec(this,e)}};e.setParent(E,T);return T};M.addCommand("repeat",function(e,r,n){if(n.matchToken("repeat")){return t(e,n,r,false)}});M.addCommand("for",function(e,r,n){if(n.matchToken("for")){return t(e,n,r,true)}});M.addGrammarElement("stringLike",function(e,r,n){return M.parseAnyOf(["string","nakedString"],n)});M.addCommand("fetch",function(e,i,r){if(r.matchToken("fetch")){var n=e.requireElement("stringLike",r);var t=e.parseElement("objectLiteral",r);var o="text";if(r.matchToken("as")){if(r.matchToken("json")){o="json"}else if(r.matchToken("response")){o="response"}else if(r.matchToken("text")){}else{e.raiseParseError(r,"Unknown response type: "+r.currentToken())}}var u={url:n,argExrepssions:t,args:[n,t],op:function(t,e,a){return new Promise(function(r,n){fetch(e,a).then(function(e){if(o==="response"){t.result=e;r(i.findNext(u,t))}else if(o==="json"){e.json().then(function(e){t.result=e;r(i.findNext(u,t))})}else{e.text().then(function(e){t.result=e;r(i.findNext(u,t))})}}).catch(function(e){i.triggerEvent(t.me,"fetch:error",{reason:e});n(e)})})}};return u}})}function e(e){if(document.readyState!=="loading"){e()}else{document.addEventListener("DOMContentLoaded",e)}}function i(){var e=document.querySelector('meta[name="htmx-config"]');if(e){return r(e.content)}else{return null}}function o(){var e=i();if(e){_hyperscript.config=c(_hyperscript.config,e)}}if("document"in P){e(function(){o();_.processNode(document.body);document.addEventListener("htmx:load",function(e){_.processNode(e.detail.elt)})})}return c(function(e,r){return _.evaluate(e,r)},{internals:{lexer:F,parser:M,runtime:_},addFeature:function(e,r){M.addFeature(e,r)},addCommand:function(e,r){M.addCommand(e,r)},addLeafExpression:function(e,r){M.addLeafExpression(e,r)},addIndirectExpression:function(e,r){M.addIndirectExpression(r)},evaluate:function(e,r){return _.evaluate(e,r)},parse:function(e){return _.parse(e)},processNode:function(e){_.processNode(e)},config:{attributes:"_, script, data-script",defaultTransition:"all 500ms ease-in",conversions:j}})}()});(function(){function o(e,r){for(var n in r){if(r.hasOwnProperty(n)){e[n]=r[n]}}return e}_hyperscript.addCommand("settle",function(e,o,r){if(r.matchToken("settle")){if(!e.commandBoundary(r.currentToken())){var n=e.requireElement("expression",r)}else{var n=e.requireElement("implicitMeTarget",r)}var u={type:"settleCmd",args:[n],op:function(e,r){var n=null;var t=false;var a=false;var i=new Promise(function(e){n=e});r.addEventListener("transitionstart",function(){a=true},{once:true});setTimeout(function(){if(!a&&!t){n(o.findNext(u,e))}},500);r.addEventListener("transitionend",function(){if(!t){n(o.findNext(u,e))}},{once:true});return i},execute:function(e){return o.unifiedExec(this,e)}};return u}});_hyperscript.addCommand("add",function(e,t,r){if(r.matchToken("add")){var n=e.parseElement("classRef",r);var a=null;var i=null;if(n==null){a=e.parseElement("attributeRef",r);if(a==null){i=e.parseElement("objectLiteral",r);if(i==null){e.raiseParseError(r,"Expected either a class reference or attribute expression")}}}else{var o=[n];while(n=e.parseElement("classRef",r)){o.push(n)}}if(r.matchToken("to")){var u=e.requireElement("targetExpression",r)}else{var u=e.parseElement("implicitMeTarget",r)}if(o){var s={classRefs:o,to:u,args:[u],op:function(e,n){t.forEach(o,function(r){t.forEach(n,function(e){e.classList.add(r.className())})});return t.findNext(this,e)}}}else if(a){var s={type:"addCmd",attributeRef:a,to:u,args:[u,a],op:function(e,r,n){t.forEach(r,function(e){e.setAttribute(n.name,n.value)});return t.findNext(s,e)},execute:function(e){return t.unifiedExec(this,e)}}}else{var s={type:"addCmd",cssDeclaration:i,to:u,args:[u,i],op:function(e,r,n){t.forEach(r,function(e){for(var r in n){if(n.hasOwnProperty(r)){e.style.setProperty(r,n[r])}}});return t.findNext(s,e)},execute:function(e){return t.unifiedExec(this,e)}}}return s}});_hyperscript.addCommand("remove",function(e,t,r){if(r.matchToken("remove")){var n=e.parseElement("classRef",r);var a=null;var i=null;if(n==null){a=e.parseElement("attributeRef",r);if(a==null){i=e.parseElement("expression",r);if(i==null){e.raiseParseError(r,"Expected either a class reference, attribute expression or value expression")}}}else{var o=[n];while(n=e.parseElement("classRef",r)){o.push(n)}}if(r.matchToken("from")){var u=e.requireElement("targetExpression",r)}else{var u=e.requireElement("implicitMeTarget",r)}if(i){var s={elementExpr:i,from:u,args:[i],op:function(e,r){t.forEach(r,function(e){e.parentElement.removeChild(e)});return t.findNext(this,e)}}}else{var s={classRefs:o,attributeRef:a,elementExpr:i,from:u,args:[u],op:function(e,n){if(this.classRefs){t.forEach(o,function(r){t.forEach(n,function(e){e.classList.remove(r.className())})})}else{t.forEach(n,function(e){e.removeAttribute(a.name)})}return t.findNext(this,e)}}}return s}});_hyperscript.addCommand("toggle",function(e,u,r){if(r.matchToken("toggle")){if(r.matchToken("between")){var n=true;var t=e.parseElement("classRef",r);r.requireToken("and");var a=e.requireElement("classRef",r)}else{var t=e.parseElement("classRef",r);var i=null;if(t==null){i=e.parseElement("attributeRef",r);if(i==null){e.raiseParseError(r,"Expected either a class reference or attribute expression")}}else{var o=[t];while(t=e.parseElement("classRef",r)){o.push(t)}}}if(r.matchToken("on")){var s=e.requireElement("targetExpression",r)}else{var s=e.requireElement("implicitMeTarget",r)}if(r.matchToken("for")){var l=e.requireElement("timeExpression",r)}else if(r.matchToken("until")){var c=e.requireElement("dotOrColonPath",r,"Expected event name");if(r.matchToken("from")){var f=e.requireElement("expression",r)}}var m={classRef:t,classRef2:a,classRefs:o,attributeRef:i,on:s,time:l,evt:c,from:f,toggle:function(e,r){if(n){u.forEach(e,function(e){if(e.classList.contains(t.className())){e.classList.remove(t.className());e.classList.add(a.className())}else{e.classList.add(t.className());e.classList.remove(a.className())}})}else if(this.classRefs){u.forEach(this.classRefs,function(r){u.forEach(e,function(e){e.classList.toggle(r.className())})})}else{u.forEach(e,function(e){if(e.hasAttribute(i.name)){e.removeAttribute(i.name)}else{e.setAttribute(i.name,r)}})}},args:[s,i?i.value:null,l,c,f],op:function(n,t,a,r,i,o){if(r){return new Promise(function(e){m.toggle(t,a);setTimeout(function(){m.toggle(t,a);e(u.findNext(m,n))},r)})}else if(i){return new Promise(function(e){var r=o||n.me;r.addEventListener(i,function(){m.toggle(t,a);e(u.findNext(m,n))},{once:true});m.toggle(t,a)})}else{this.toggle(t,a);return u.findNext(m,n)}}};return m}});var u={display:function(e,r,n){if(n){r.style.display=n}else if(e==="hide"){r.style.display="none"}else{r.style.display="block"}},visibility:function(e,r,n){if(n){r.style.visibility=n}else if(e==="hide"){r.style.visibility="hidden"}else{r.style.visibility="visible"}},opacity:function(e,r,n){if(n){r.style.opacity=n}else if(e==="hide"){r.style.opacity="0"}else{r.style.opacity="1"}}};var s=function(e,r,n){var t;var a=n.currentToken();if(a.value==="with"||e.commandBoundary(a)){t=e.parseElement("implicitMeTarget",n)}else{t=e.parseElement("targetExpression",n)}return t};var l=function(e,r,n){var t=_hyperscript.config.defaultHideShowStrategy;var a=u;if(_hyperscript.config.hideShowStrategies){a=o(a,_hyperscript.config.hideShowStrategies)}n=n||t||"display";var i=a[n];if(i==null){e.raiseParseError(r,"Unknown show/hide strategy : "+n)}return i};_hyperscript.addCommand("hide",function(e,n,r){if(r.matchToken("hide")){var t=s(e,n,r);var a=null;if(r.matchToken("with")){a=r.requireTokenType("IDENTIFIER").value}var i=l(e,r,a);return{target:t,args:[t],op:function(e,r){n.forEach(r,function(e){i("hide",e)});return n.findNext(this,e)}}}});_hyperscript.addCommand("show",function(e,n,r){if(r.matchToken("show")){var t=s(e,n,r);var a=null;if(r.matchToken("with")){a=r.requireTokenType("IDENTIFIER").value}var i=null;if(r.matchOpToken(":")){var o=r.consumeUntilWhitespace();r.matchTokenType("WHITESPACE");i=o.map(function(e){return e.value}).join("")}var u=l(e,r,a);return{target:t,args:[t],op:function(e,r){n.forEach(r,function(e){u("show",e,i)});return n.findNext(this,e)}}}});_hyperscript.addCommand("trigger",function(e,t,r){if(r.matchToken("trigger")){var n=e.requireElement("dotOrColonPath",r);var a=e.parseElement("namedArgumentList",r);var i={eventName:n,details:a,args:[n,a],op:function(e,r,n){t.triggerEvent(e.me,r,n?n:{});return t.findNext(i,e)}};return i}});_hyperscript.addCommand("take",function(e,a,r){if(r.matchToken("take")){var n=e.parseElement("classRef",r);if(r.matchToken("from")){var t=e.requireElement("targetExpression",r)}else{var t=n}if(r.matchToken("for")){var i=e.requireElement("targetExpression",r)}else{var i=e.requireElement("implicitMeTarget",r)}var o={classRef:n,from:t,forElt:i,args:[t,i],op:function(e,r,n){var t=this.classRef.css.substr(1);a.forEach(r,function(e){e.classList.remove(t)});a.forEach(n,function(e){e.classList.add(t)});return a.findNext(this,e)}};return o}});function f(e,r,n){if(r){var t=e[r]}else{var t=e}if(t instanceof Element||t instanceof HTMLDocument){t.innerHTML=n}else{if(r){e[r]=n}else{throw"Don't know how to put a value into "+typeof e}}}_hyperscript.addCommand("put",function(e,t,r){if(r.matchToken("put")){var n=e.requireElement("expression",r);var a=r.matchAnyToken("into","before","after");if(a==null&&r.matchToken("at")){a=r.matchAnyToken("start","end");r.requireToken("of")}if(a==null){e.raiseParseError(r,"Expected one of 'into', 'before', 'at start of', 'at end of', 'after'")}var i=e.requireElement("targetExpression",r);var o=a.value;var u=false;var s=null;var l=null;if(i.type==="propertyAccess"&&o==="into"){l=i.prop.value;s=i.root}else if(i.type==="symbol"&&o==="into"){u=true;l=i.name}else{s=i}var c={target:i,operation:o,symbolWrite:u,value:n,args:[s,n],op:function(e,r,n){if(u){f(e,l,n);e[i.name]=n}else{if(o==="into"){t.forEach(r,function(e){f(e,l,n)})}else if(o==="before"){t.forEach(r,function(e){e.insertAdjacentHTML("beforebegin",n)})}else if(o==="start"){t.forEach(r,function(e){e.insertAdjacentHTML("afterbegin",n)})}else if(o==="end"){t.forEach(r,function(e){e.insertAdjacentHTML("beforeend",n)})}else if(o==="after"){t.forEach(r,function(e){e.insertAdjacentHTML("afterend",n)})}}return t.findNext(this,e)}};return c}});_hyperscript.addCommand("transition",function(e,h,r){if(r.matchToken("transition")){if(r.matchToken("element")||r.matchToken("elements")){var n=e.parseElement("expression",r)}else{var n=e.parseElement("implicitMeTarget",r)}var d=[];var t=[];var a=[];var i=r.currentToken();while(!e.commandBoundary(i)&&i.value!=="using"){d.push(r.requireTokenType("IDENTIFIER").value);if(r.matchToken("from")){t.push(e.requireElement("stringLike",r))}else{t.push(null)}r.requireToken("to");a.push(e.requireElement("stringLike",r));i=r.currentToken()}if(r.matchToken("using")){var o=e.requireElement("expression",r)}var u={to:a,args:[n,t,a,o],op:function(e,r,m,p,v){var n=[];h.forEach(r,function(f){var e=new Promise(function(i,e){var o=f.style.transition;f.style.transition=v||_hyperscript.config.defaultTransition;var u=h.getInternalData(f);var r=getComputedStyle(f);var n={};for(var t=0;t<r.length;t++){var a=r[t];var s=r[a];n[a]=s}if(!u.initalStyles){u.initalStyles=n}for(var t=0;t<d.length;t++){var l=d[t];var c=m[t];if(c=="computed"||c==null){f.style[l]=n[l]}else{f.style[l]=c}}setTimeout(function(){var e=[];for(var r=0;r<d.length;r++){var n=d[r];var t=p[r];if(t=="initial"){var a=u.initalStyles[n];f.style[n]=a}else{f.style[n]=t}}f.addEventListener("transitionend",function(){f.style.transition=o;i()},{once:true})},5)});n.push(e)});return Promise.all(n).then(function(){return h.findNext(u,e)})}};return u}});_hyperscript.addLeafExpression("closestExpr",function(e,r,n){if(n.matchToken("closest")){var t=e.parseElement("targetExpression",n);if(t.css==null){e.raiseParseError(n,"Expected a CSS expression")}if(n.matchToken("to")){var a=e.parseElement("targetExpression",n)}else{var a=e.parseElement("implicitMeTarget",n)}return{expr:t,to:a,args:[a],op:function(e,r){return r==null?null:r.closest(t.css)},evaluate:function(e){return r.unifiedEval(this,e)}}}});_hyperscript.config.conversions["Values"]=function(e){var r=u(e);if(r!==undefined){return r.value}if(e.querySelectorAll!=undefined){var n={};var t=e.querySelectorAll("input,select,textarea");for(var a=0;a<t.length;a++){var i=t[a];o(n,i)}return n}return null;function o(e,r){var n=u(r);if(n==undefined){return}if(e[n.name]==undefined){e[n.name]=n.value;return}if(Array.isArray(e[n.name])&&Array.isArray(n.value)){e[n.name]=[].concat(e[n.name],n.value);return}}function u(e){try{var r={name:e.name,value:e.value};if(r.name==undefined||r.value==undefined){return undefined}if(e.type=="radio"&&e.checked==false){return undefined}if(e.type=="checkbox"){if(e.checked==false){r.value=undefined}else if(typeof r.value==="string"){r.value=[r.value]}}if(e.type=="select-multiple"){var n=e.querySelectorAll("option[selected]");r.value=[];for(var t=0;t<n.length;t++){r.value.push(n[t].value)}}return r}catch(e){return undefined}}}})();