(function(e,r){if(typeof define==="function"&&define.amd){define([],r)}else{e._hyperscript=r()}})(typeof self!=="undefined"?self:this,function(){return function(){"use strict";function c(e,r){for(var t in r){if(r.hasOwnProperty(t)){e[t]=r[t]}}return e}function r(e){try{return JSON.parse(e)}catch(e){t(e);return null}}function t(e){if(console.error){console.error(e)}else if(console.log){console.log("ERROR: ",e)}}function f(e,r){return new(e.bind.apply(e,[e].concat(r)))}function x(e,r,t){var n=window;while(e.length>0){var a=e.shift();var i=n[a];if(i==null){i={};n[a]=i}n=i}n[r]=t}var b=typeof self!=="undefined"?self:this;var N=function(){var k={"+":"PLUS","-":"MINUS","*":"MULTIPLY","/":"DIVIDE",".":"PERIOD","\\":"BACKSLASH",":":"COLON","%":"PERCENT","|":"PIPE","!":"EXCLAMATION","?":"QUESTION","#":"POUND","&":"AMPERSAND",";":"SEMI",",":"COMMA","(":"L_PAREN",")":"R_PAREN","<":"L_ANG",">":"R_ANG","<=":"LTE_ANG",">=":"GTE_ANG","==":"EQ","===":"EQQ","!=":"NEQ","!==":"NEQQ","{":"L_BRACE","}":"R_BRACE","[":"L_BRACKET","]":"R_BRACKET","=":"EQUALS"};function g(e){return R(e)||N(e)||e==="-"||e==="_"}function O(e){return R(e)||N(e)||e==="-"||e==="_"||e===":"}function w(e){return e===" "||e==="\t"||b(e)}function C(e){return"[Line: "+e.line+", Column: "+e.col+"]"}function b(e){return e==="\r"||e==="\n"}function N(e){return e>="0"&&e<="9"}function R(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function I(e){return e==="_"||e==="$"}function A(e){return e==="`"||e==="^"}function P(r,t,e){var n=true;l("WHITESPACE");function i(e,r){G.raiseParseError(e,r)}function a(e){var r=u(e);if(r){return r}else{i(this,"Expected '"+e+"' but found '"+d().value+"'")}}function o(e,r,t){for(var n=0;n<arguments.length;n++){var a=arguments[n];var i=u(a);if(i){return i}}}function u(e){if(d()&&d().op&&d().value===e){return m()}}function s(e,r,t,n){var a=l(e,r,t,n);if(a){return a}else{i(this,"Expected one of "+JSON.stringify([e,r,t]))}}function l(e,r,t,n){if(d()&&d().type&&[e,r,t,n].indexOf(d().type)>=0){return m()}}function c(e,r){var t=f(e,r);if(t){return t}else{i(this,"Expected '"+e+"' but found '"+d().value+"'")}}function f(e,r){var r=r||"IDENTIFIER";if(d()&&d().value===e&&d().type===r){return m()}}function m(){var e=r.shift();t.push(e);if(n){l("WHITESPACE")}return e}function p(){var e=[];n=false;while(d()&&d().type!=="WHITESPACE"){e.push(m())}n=true;return e}function v(){return r.length>0}function d(){var e=r[0];if(e){return e}else{return{type:"EOF"}}}return{matchAnyOpToken:o,matchOpToken:u,requireOpToken:a,matchTokenType:l,requireTokenType:s,consumeToken:m,matchToken:f,requireToken:c,list:r,consumed:t,source:e,hasMore:v,currentToken:d,consumeUntilWhitespace:p}}function e(e){var r=e;var t=[];var n=0;var a=0;var i=1;var o="<START>";while(n<r.length){if(h()==="-"&&E()==="-"){l()}else{if(w(h())){t.push(y())}else if(!x()&&h()==="."&&R(E())){t.push(c())}else if(!x()&&h()==="#"&&R(E())){t.push(f())}else if(R(h())||I(h())){t.push(m())}else if(N(h())){t.push(p())}else if(h()==='"'||h()==="'"){t.push(d())}else if(k[h()]){t.push(v())}else if(A(h())){t.push(s("RESERVED",h))}else{if(n<r.length){throw Error("Unknown token: "+h()+" ")}}}}return P(t,[],r);function u(e,r){var t=s(e,r);t.op=true;return t}function s(e,r){return{type:e,value:r,start:n,end:n+1,column:a,line:i}}function l(){while(h()&&!b(h())){T()}T()}function c(){var e=s("CLASS_REF");var r=T();while(g(h())){r+=T()}e.value=r;e.end=n;return e}function f(){var e=s("ID_REF");var r=T();while(O(h())){r+=T()}e.value=r;e.end=n;return e}function m(){var e=s("IDENTIFIER");var r=T();while(R(h())||I(h())){r+=T()}e.value=r;e.end=n;return e}function p(){var e=s("NUMBER");var r=T();while(N(h())){r+=T()}if(h()==="."){r+=T()}while(N(h())){r+=T()}e.value=r;e.end=n;return e}function v(){var e=T();while(h()&&k[e+h()]){e+=T()}var r=u(k[e],e);r.value=e;r.end=n;return r}function d(){var e=s("STRING");var r=T();var t="";while(h()&&h()!==r){if(h()==="\\"){T()}t+=T()}if(h()!==r){throw Error("Unterminated string at "+C(e))}else{T()}e.value=t;e.end=n;return e}function h(){return r.charAt(n)}function E(){return r.charAt(n+1)}function T(){o=h();n++;a++;return o}function x(){return R(o)||N(o)||o===")"||o==="}"||o==="]"}function y(){var e=s("WHITESPACE");var r="";while(h()&&w(h())){if(b(h())){a=0;i++}r+=T()}e.value=r;e.end=n;return e}}return{tokenize:e,makeTokensObject:P}}();var G=function(){var a={};function e(e,r){a[e]=r}function n(e){var r=e.currentToken();var t=e.source;var n=t.split("\n");var a=r?r.line-1:n.length-1;var i=n[a];var o=r?r.column:i.length-1;return i+"\n"+" ".repeat(o)+"^^\n\n"}function i(e,r){r=(r||"Unexpected Token : "+e.currentToken().value)+"\n\n"+n(e);var t=new Error(r);t.tokens=e;throw t}function r(e,r,t,n){var a=o(r,t,n);return a||i(t,e)}function o(e,r,t){var n=a[e];if(n)return n(G,r,t)}function t(e,r){for(var t=0;t<e.length;t++){var n=e[t];var a=o(n,r);if(a){return a}}}function u(e){return o("hyperscript",e)}function s(e,r){if(e){e.parent=r;s(e.next,r)}}return{setParent:s,requireElement:r,parseElement:o,parseAnyOf:t,parseHyperScript:u,raiseParseError:i,addGrammarElement:e}}();var R=function(){function t(e,r){var t=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return t&&t.call(e,r)}function i(e,r){var t;if(window.CustomEvent&&typeof window.CustomEvent==="function"){t=new CustomEvent(e,{bubbles:true,cancelable:true,detail:r})}else{t=document.createEvent("CustomEvent");t.initCustomEvent(e,true,true,r)}return t}function o(e,r,t){var t=t||{};t["sentBy"]=e;var n=i(r,t);var a=e.dispatchEvent(n);return a}function a(e,r){if(e==null){}else if(e.length!=null){for(var t=0;t<e.length;t++){r(e[t])}}else{r(e)}}var u={array_sentinel:true};function f(e){var r=[];for(var t=0;t<e.length;t++){var n=e[t];if(Array.isArray(n)){r.push(u);for(var a=0;a<n.length;a++){r.push(n[a])}r.push(u)}else{r.push(n)}}return r}function m(e){var r=[];for(var t=0;t<e.length;t++){var n=e[t];if(n===u){n=e[++t];var a=[];r.push(a);while(n!==u){a.push(n);n=e[++t]}}else{r.push(n)}}return r}function p(e){for(var r=0;r<e.length;r++){var t=e[r];if(t.asyncWrapper){e[r]=t.value}if(Array.isArray(t)){for(var n=0;n<t.length;n++){var a=t[n];if(a.asyncWrapper){t[n]=a.value}}}}}var n={halt_flag:true};function s(e,r){while(true){var t=l(e,r);if(t==null){console.error(e," did not return a next element to execute! context: ",r);return}else if(t.then){t.then(function(e){s(e,r)}).catch(function(e){if(r.meta&&r.meta.reject){r.meta.reject(e)}else{}});return}else if(t===n){return}else{e=t}}}function l(a,r){var e=false;var i=false;var o=[r];if(a.args){for(var t=0;t<a.args.length;t++){var n=a.args[t];if(n==null){o.push(null)}else if(Array.isArray(n)){var u=[];for(var s=0;s<n.length;s++){var l=n[s];var c=l.evaluate(r);if(c){if(c.then){e=true}else if(c.asyncWrapper){i=true}}u.push(c)}o.push(u)}else if(n.evaluate){var c=n.evaluate(r);if(c){if(c.then){e=true}else if(c.asyncWrapper){i=true}}o.push(c)}else{o.push(n)}}}if(e){return new Promise(function(t,n){var e=f(o);Promise.all(e).then(function(e){e=m(e);if(i){p(e)}try{var r=a.op.apply(a,e);t(r)}catch(e){n(e)}}).catch(function(e){if(r.meta&&r.meta.reject){r.meta.reject(e)}else{}})})}else{if(i){p(o)}try{return a.op.apply(a,o)}catch(e){if(r.meta&&r.meta.reject){r.meta.reject(e)}else{throw e}}}}function e(e,r){if(e==null){return null}if(e.length){var t=e}else{var t=[e]}while(r.length>0){var n=r.shift();var a=[];for(var i=0;i<t.length;i++){var o=t[i];var u=o[n];if(u&&u.length){a=a.concat(u)}else{a.push(u)}}t=a}return t}var r=null;function c(){if(r==null){r=_hyperscript.config.attributes.replace(/ /g,"").split(",")}return r}function v(e){for(var r=0;r<c().length;r++){var t=c()[r];if(e.hasAttribute&&e.hasAttribute(t)){return e.getAttribute(t)}}if(e.type==="text/hyperscript"){return e.innerText}return null}function d(e,r,t){var n={meta:{parser:G,lexer:N,runtime:R,root:e,iterators:e},me:r,event:t,detail:t?t.detail:null,body:"document"in b?document.body:null};n.meta.ctx=n;return n}function h(e,n){a(e.onFeatures,function(t){a(t.elsewhere?[document]:t.from?t.from.evaluate({}):[n],function(e){e.addEventListener(t.on.evaluate(),function(e){if(t.elsewhere&&n.contains(e.target))return;var r=d(t,n,e);t.execute(r)})})})}function E(){return c().map(function(e){return"["+e+"]"}).join(", ")}function T(e,r){return Object.prototype.toString.call(e)==="[object "+r+"]"}function x(e,r,t){if(T(r,"Object")){var n=e;var a=r;var i="expression"}else if(T(r,"String")){var n=r;var i=e;var a=t}else{var n=e;var a={};var i="expression"}a=a||{};var o=G.parseElement(i,N.tokenize(n));return o.evaluate?o.evaluate(a):o.execute(a)}function y(e){var r=R.getScriptSelector();if(t(e,r)){k(e)}if(e.querySelectorAll){a(e.querySelectorAll(r),function(e){k(e)})}if(e.type==="text/hyperscript"){k(e,document.body)}if(e.querySelectorAll){a(e.querySelectorAll("[type='text/hyperscript']"),function(e){k(e,document.body)})}}function k(r,e){var t=g(r);if(!t.initialized){var n=v(r);if(n){try{t.initialized=true;t.script=n;var a=N.tokenize(n);var i=G.parseHyperScript(a);R.applyEventListeners(i,e||r);setTimeout(function(){o(e||r,"load")},1)}catch(e){console.error("hyperscript errors were found on the following element:",r,"\n\n",e.message)}}}}function g(e){var r="hyperscript-internal-data";var t=e[r];if(!t){t=e[r]={}}return t}function O(e,r,t){if(e==null&&t){return e}var n=Object.prototype.toString.call(e).slice(8,-1);var a=e&&n===r;if(a){return e}else{throw new Error("Typecheck failed!  Expected: "+r+", Found: "+n)}}function w(e,r){if(e==="me"||e==="my"){return r["me"]}if(e==="it"||e==="its"){return r["it"]}else{if(r.meta&&r.meta.context){var t=r.meta.context[e];if(typeof t!=="undefined"){return t}}var n=r[e];if(typeof n!=="undefined"){return n}else{return b[e]}}}function C(e){if(e){if(e.resolveNext){return e.resolveNext()}else if(e.next){return e.next}else{return C(e.parent)}}}return{typeCheck:O,forEach:a,evalTarget:e,triggerEvent:o,matchesSelector:t,getScript:v,applyEventListeners:h,processNode:y,evaluate:x,getScriptSelector:E,resolveSymbol:w,makeContext:d,findNext:C,unifiedEval:l,unifiedExec:s,HALT:n}}();{G.addGrammarElement("parenthesized",function(e,r){if(r.matchOpToken("(")){var t=e.parseElement("expression",r);r.requireOpToken(")");return{type:"parenthesized",expr:t,evaluate:function(e){return t.evaluate(e)}}}});G.addGrammarElement("string",function(e,r){var t=r.matchTokenType("STRING");if(t){return{type:"string",token:t,evaluate:function(e){return t.value}}}});G.addGrammarElement("nakedString",function(e,r){if(r.hasMore()){var t=r.consumeUntilWhitespace();r.matchTokenType("WHITESPACE");return{type:"nakedString",tokens:t,evaluate:function(e){return t.map(function(e){return e.value}).join("")}}}});G.addGrammarElement("number",function(e,r){var t=r.matchTokenType("NUMBER");if(t){var n=t;var a=parseFloat(t.value);return{type:"number",value:a,numberToken:n,evaluate:function(){return a}}}});G.addGrammarElement("idRef",function(e,r){var t=r.matchTokenType("ID_REF");if(t){return{type:"idRef",value:t.value.substr(1),evaluate:function(e){return document.getElementById(this.value)}}}});G.addGrammarElement("classRef",function(e,r){var t=r.matchTokenType("CLASS_REF");if(t){return{type:"classRef",value:t.value,className:function(){return this.value.substr(1)},evaluate:function(){return document.querySelectorAll(this.value)}}}});G.addGrammarElement("attributeRef",function(e,r){if(r.matchOpToken("[")){var t=r.matchTokenType("IDENTIFIER");var n=null;if(r.matchOpToken("=")){n=e.parseElement("expression",r)}r.requireOpToken("]");return{type:"attribute_expression",name:t.value,value:n,args:[n],op:function(e,r){if(this.value){return{name:this.name,value:r}}else{return{name:this.name}}},evaluate:function(e){return R.unifiedEval(this,e)}}}});G.addGrammarElement("objectLiteral",function(e,r){if(r.matchOpToken("{")){var i=[];var t=[];if(!r.matchOpToken("}")){do{var n=r.requireTokenType("IDENTIFIER");r.requireOpToken(":");var a=e.parseElement("expression",r);t.push(a);i.push({name:n,value:a})}while(r.matchOpToken(","));r.requireOpToken("}")}return{type:"objectLiteral",fields:i,args:[t],op:function(e,r){var t={};for(var n=0;n<r.length;n++){var a=i[n];t[a.name.value]=r[n]}return t},evaluate:function(e){return R.unifiedEval(this,e)}}}});G.addGrammarElement("namedArgumentList",function(e,r){if(r.matchOpToken("(")){var i=[];var t=[];if(!r.matchOpToken(")")){do{var n=r.requireTokenType("IDENTIFIER");r.requireOpToken(":");var a=e.parseElement("expression",r);t.push(a);i.push({name:n,value:a})}while(r.matchOpToken(","));r.requireOpToken(")")}return{type:"namedArgumentList",fields:i,args:[t],op:function(e,r){var t={_namedArgList_:true};for(var n=0;n<r.length;n++){var a=i[n];t[a.name.value]=r[n]}return t},evaluate:function(e){return R.unifiedEval(this,e)}}}});G.addGrammarElement("symbol",function(e,r){var t=r.matchTokenType("IDENTIFIER");if(t){return{type:"symbol",name:t.value,evaluate:function(e){return R.resolveSymbol(t.value,e)}}}});G.addGrammarElement("implicitMeTarget",function(e,r){return{type:"implicitMeTarget",evaluate:function(e){return e.me}}});G.addGrammarElement("implicitAllTarget",function(e,r){return{type:"implicitAllTarget",evaluate:function(e){return document.querySelectorAll("*")}}});G.addGrammarElement("boolean",function(e,r){var t=r.matchToken("true")||r.matchToken("false");if(t){return{type:"boolean",evaluate:function(e){return t.value==="true"}}}});G.addGrammarElement("null",function(e,r){if(r.matchToken("null")){return{type:"null",evaluate:function(e){return null}}}});G.addGrammarElement("arrayLiteral",function(e,r){if(r.matchOpToken("[")){var t=[];if(!r.matchOpToken("]")){do{var n=e.parseElement("expression",r);if(n==null){e.raiseParseError(r,"Expected an expression")}t.push(n)}while(r.matchOpToken(","));r.requireOpToken("]")}return{type:"arrayLiteral",values:t,args:[t],op:function(e,r){return r},evaluate:function(e){return R.unifiedEval(this,e)}}}});G.addGrammarElement("blockLiteral",function(e,r){if(r.matchOpToken("\\")){var t=[];var n=r.matchTokenType("IDENTIFIER");if(n){t.push(n);while(r.matchOpToken(",")){t.push(r.requireTokenType("IDENTIFIER"))}}r.requireOpToken("-");r.requireOpToken(">");var a=e.parseElement("expression",r);if(a==null){e.raiseParseError(r,"Expected an expression")}return{type:"blockLiteral",args:t,expr:a,evaluate:function(r){var e=function(){for(var e=0;e<t.length;e++){r[t[e].value]=arguments[e]}return a.evaluate(r)};return e}}}});G.addGrammarElement("leaf",function(e,r){return e.parseAnyOf(["parenthesized","boolean","null","string","number","idRef","classRef","symbol","propertyRef","objectLiteral","arrayLiteral","blockLiteral"],r)});G.addGrammarElement("timeExpression",function(e,r){var t=e.requireElement("Expected a time expression","expression",r);var n=1;if(r.matchToken("s")||r.matchToken("seconds")){n=1e3}else if(r.matchToken("ms")||r.matchToken("milliseconds")){}return{type:"timeExpression",time:t,factor:n,args:[t],op:function(e,r){return r*this.factor},evaluate:function(e){return R.unifiedEval(this,e)}}});G.addGrammarElement("propertyAccess",function(e,r,t){if(r.matchOpToken(".")){var n=r.requireTokenType("IDENTIFIER");var a={type:"propertyAccess",root:t,prop:n,args:[t],op:function(e,r){return r==null?null:r[n.value]},evaluate:function(e){return R.unifiedEval(this,e)}};return G.parseElement("indirectExpression",r,a)}});G.addGrammarElement("functionCall",function(e,r,a){if(r.matchOpToken("(")){var t=[];if(!r.matchOpToken(")")){do{t.push(e.parseElement("expression",r))}while(r.matchOpToken(","));r.requireOpToken(")")}if(a.root){var n={type:"functionCall",root:a,argExressions:t,args:[a.root,t],op:function(e,r,t){var n=r[a.prop.value];return n.apply(r,t)},evaluate:function(e){return R.unifiedEval(this,e)}}}else{var n={type:"functionCall",root:a,argExressions:t,args:[a,t],op:function(e,r,t){var n=r.apply(null,t);return n},evaluate:function(e){return R.unifiedEval(this,e)}}}return G.parseElement("indirectExpression",r,n)}});G.addGrammarElement("indirectExpression",function(e,r,t){var n=e.parseElement("propertyAccess",r,t);if(n){return n}var a=e.parseElement("functionCall",r,t);if(a){return a}return t});G.addGrammarElement("primaryExpression",function(e,r){var t=e.parseElement("leaf",r);if(t){return e.parseElement("indirectExpression",r,t)}e.raiseParseError(r,"Unexpected value: "+r.currentToken().value)});G.addGrammarElement("postfixExpression",function(e,r){var t=e.parseElement("primaryExpression",r);if(r.matchOpToken(":")){var n=r.requireTokenType("IDENTIFIER");var a=!r.matchOpToken("!");return{type:"typeCheck",typeName:n,root:t,nullOk:a,args:[t],op:function(e,r){return R.typeCheck(r,this.typeName.value,this.nullOk)},evaluate:function(e){return R.unifiedEval(this,e)}}}else{return t}});G.addGrammarElement("logicalNot",function(e,r){if(r.matchToken("not")){var t=e.parseElement("unaryExpression",r);return{type:"logicalNot",root:t,args:[t],op:function(e,r){return!r},evaluate:function(e){return R.unifiedEval(this,e)}}}});G.addGrammarElement("negativeNumber",function(e,r){if(r.matchOpToken("-")){var t=e.parseElement("unaryExpression",r);return{type:"negativeNumber",root:t,args:[t],op:function(e,r){return-1*r},evaluate:function(e){return R.unifiedEval(this,e)}}}});G.addGrammarElement("unaryExpression",function(e,r){return e.parseAnyOf(["logicalNot","negativeNumber","postfixExpression"],r)});G.addGrammarElement("mathOperator",function(e,r){var t=e.parseElement("unaryExpression",r);var n,a=null;n=r.matchAnyOpToken("+","-","*","/","%");while(n){a=a||n;var i=n.value;if(a.value!==i){e.raiseParseError(r,"You must parenthesize math operations with different operators")}var o=e.parseElement("unaryExpression",r);t={type:"mathOperator",lhs:t,rhs:o,operator:i,args:[t,o],op:function(e,r,t){if(this.operator==="+"){return r+t}else if(this.operator==="-"){return r-t}else if(this.operator==="*"){return r*t}else if(this.operator==="/"){return r/t}else if(this.operator==="%"){return r%t}},evaluate:function(e){return R.unifiedEval(this,e)}};n=r.matchAnyOpToken("+","-","*","/","%")}return t});G.addGrammarElement("mathExpression",function(e,r){return e.parseAnyOf(["mathOperator","unaryExpression"],r)});G.addGrammarElement("comparisonOperator",function(e,r){var t=e.parseElement("mathExpression",r);var n,a=null;n=r.matchAnyOpToken("<",">","<=",">=","==","===","!=","!==");while(n){a=a||n;if(a.value!==n.value){e.raiseParseError(r,"You must parenthesize comparison operations with different operators")}var i=e.parseElement("mathExpression",r);t={type:"comparisonOperator",operator:n.value,lhs:t,rhs:i,args:[t,i],op:function(e,r,t){if(this.operator==="<"){return r<t}else if(this.operator===">"){return r>t}else if(this.operator==="<="){return r<=t}else if(this.operator===">="){return r>=t}else if(this.operator==="=="){return r==t}else if(this.operator==="==="){return r===t}else if(this.operator==="!="){return r!=t}else if(this.operator==="!=="){return r!==t}},evaluate:function(e){return R.unifiedEval(this,e)}};n=r.matchAnyOpToken("<",">","<=",">=","==","===","!=","!==")}return t});G.addGrammarElement("comparisonExpression",function(e,r){return e.parseAnyOf(["comparisonOperator","mathExpression"],r)});G.addGrammarElement("logicalOperator",function(e,r){var t=e.parseElement("comparisonExpression",r);var n,a=null;n=r.matchToken("and")||r.matchToken("or");while(n){a=a||n;if(a.value!==n.value){e.raiseParseError(r,"You must parenthesize logical operations with different operators")}var i=e.parseElement("comparisonExpression",r);t={type:"logicalOperator",operator:n.value,lhs:t,rhs:i,args:[t,i],op:function(e,r,t){if(this.operator==="and"){return r&&t}else{return r||t}},evaluate:function(e){return R.unifiedEval(this,e)}};n=r.matchToken("and")||r.matchToken("or")}return t});G.addGrammarElement("logicalExpression",function(e,r){return e.parseAnyOf(["logicalOperator","mathExpression"],r)});G.addGrammarElement("asyncExpression",function(e,r){if(r.matchToken("async")){var t=e.parseElement("logicalExpression",r);var n={type:"asyncExpression",value:t,evaluate:function(e){return{asyncWrapper:true,value:this.value.evaluate(e)}}};return n}else{return e.parseElement("logicalExpression",r)}});G.addGrammarElement("expression",function(e,r){return e.parseElement("asyncExpression",r)});G.addGrammarElement("target",function(e,r){var t=e.parseAnyOf(["symbol","classRef","idRef"],r);if(t==null){e.raiseParseError(r,"Expected a valid target expression")}var n=[];while(r.matchOpToken(".")){n.push(r.requireTokenType("IDENTIFIER").value)}return{type:"target",propPath:n,root:t,args:[t],op:function(e,r){return R.evalTarget(r,n)},evaluate:function(e){return R.unifiedEval(this,e)}}});G.addGrammarElement("command",function(e,r){return e.parseAnyOf(["addCmd","removeCmd","toggleCmd","waitCmd","returnCmd","sendCmd","triggerCmd","takeCmd","logCmd","callCmd","putCmd","setCmd","ifCmd","repeatCmd","fetchCmd","throwCmd","jsCmd"],r)});G.addGrammarElement("commandList",function(e,r){var t=e.parseElement("command",r);if(t){r.matchToken("then");t.next=e.parseElement("commandList",r);return t}});G.addGrammarElement("hyperscript",function(e,r){var t=[];var n=[];var a=[];if(r.hasMore()){do{var i=e.parseElement("feature",r);if(i==null){e.raiseParseError("Unexpected feature type : "+r.currentToken())}if(i.type==="onFeature"){t.push(i)}else if(i.type==="functionFeature"){i.execute();n.push(i)}else if(i.type==="workerFeature"){a.push(i);i.execute()}else if(i.type==="jsFeature"){i.execute();if(r.hasMore())continue}var o=i.type==="onFeature"&&r.currentToken()&&r.currentToken().value==="on"}while((o||r.matchToken("end"))&&r.hasMore());if(r.hasMore()){e.raiseParseError(r)}}return{type:"hyperscript",onFeatures:t,functions:n,workers:a,execute:function(){}}});G.addGrammarElement("feature",function(e,r){return e.parseAnyOf(["onFeature","functionFeature","workerFeature","jsFeature"],r)});G.addGrammarElement("onFeature",function(e,r){if(r.matchToken("on")){var t=false;if(r.matchToken("every")){t=true}var n=e.requireElement("Expected event name","dotOrColonPath",r);var a=[];if(r.matchOpToken("(")){do{a.push(r.requireTokenType("IDENTIFIER"))}while(r.matchOpToken(","));r.requireOpToken(")")}var i=null;if(r.matchOpToken("[")){i=e.parseElement("expression",r);r.requireOpToken("]")}var o=null;var u=false;if(r.matchToken("from")){if(r.matchToken("elsewhere")){u=true}else{o=e.parseElement("target",r);if(!o){e.raiseParseError('Expected either target value or "elsewhere".',r)}}}if(o===null&&u===false&&r.matchToken("elsewhere")){u=true}var s=e.requireElement("Expected a command list","commandList",r);var l=s;while(l.next){l=l.next}l.next={type:"implicitReturn",op:function(e){e.meta.resolve();return R.HALT},execute:function(e){}};var c={type:"onFeature",args:a,on:n,every:t,from:o,elsewhere:u,filter:i,start:s,executing:false,execCount:0,execute:function(r){if(this.executing&&this.every===false){return}this.execCount++;this.executing=true;R.forEach(a,function(e){r[e.value]=r.event[e.value]||(r.event.detail?r.event.detail[e.value]:null)});if(i){var e=r.meta.context;r.meta.context=r.event;try{var t=i.evaluate(r);if(t){}else{this.executing=false;return}}finally{r.meta.context=e}}r.meta.resolve=function(){c.executing=false};r.meta.reject=function(e){console.error(e);R.triggerEvent(r.me,"exception",{error:e});c.executing=false};s.execute(r)}};e.setParent(s,c);return c}});G.addGrammarElement("functionFeature",function(e,r){if(r.matchToken("def")){var t=e.parseElement("dotOrColonPath",r);var n=t.evaluate();var a=n.split(".");var i=a.pop();var l=[];if(r.matchOpToken("(")){if(r.matchOpToken(")")){}else{do{l.push(r.requireTokenType("IDENTIFIER"))}while(r.matchOpToken(","));r.requireOpToken(")")}}var c=e.parseElement("commandList",r);var o={type:"functionFeature",name:i,args:l,start:c,execute:function(e){x(a,i,function(){var e="document"in b?document.body:null;var r="document"in b?document.body:b;var t=R.makeContext(e,r,null);for(var n=0;n<arguments.length;n++){var a=arguments[n];var i=l[n];if(i){t[i.value]=a}}var o,u=null;var s=new Promise(function(e,r){o=e;u=r});c.execute(t);if(t.meta.returned){return t.meta.returnValue}else{t.meta.resolve=o;t.meta.reject=u;return s}})}};var u=c;while(u.next){u=u.next}u.next={type:"implicitReturn",op:function(e){e.meta.returned=true;if(e.meta.resolve){e.meta.resolve()}return R.HALT},execute:function(e){}};e.setParent(c,o);return o}});if("document"in b)var y=document.currentScript.src;var k=0;var g=function(){self.onmessage=function(r){switch(r.data.type){case"init":importScripts(r.data._hyperscript);importScripts.apply(self,r.data.extraScripts);var e=_hyperscript.lexer.makeTokensObject(r.data.tokens,[],"");self.window={};var t=_hyperscript.parser.parseElement("hyperscript",e);self.functions=self.window;delete self.window;postMessage({type:"didInit"});break;case"call":try{var n=self.functions[r.data.function].apply(self,r.data.args);Promise.resolve(n).then(function(e){postMessage({type:"resolve",id:r.data.id,value:e})}).catch(function(e){postMessage({type:"reject",id:r.data.id,error:e.toString()})})}catch(e){postMessage({type:"reject",id:r.data.id,error:e.toString()})}break}}};G.addGrammarElement("workerFeature",function(e,r){if(r.matchToken("worker")){var t=e.parseElement("dotOrColonPath",r);var n=t.evaluate();var a=n.split(".");var i=a.pop();var o=[];if(r.matchOpToken("(")){if(r.matchOpToken(")")){}else{do{var u=r.requireTokenType("STRING").value;var s=new URL(u,location.href).href;o.push(s)}while(r.matchOpToken(","));r.requireOpToken(")")}}var l=[];var c=r.consumed.length;var f=r.consumed.length;do{var m=e.parseElement("functionFeature",r);if(m){l.push(m.name);f=r.consumed.length}else break}while(r.matchToken("end")&&r.hasMore());var p=r.consumed.slice(c,f+1);var v=g.toString().split("/* WORKER BOUNDARY */")[1];var d=new Blob([v],{type:"text/javascript"});var h=new Worker(URL.createObjectURL(d));h.postMessage({type:"init",_hyperscript:y,extraScripts:o,tokens:p});var E=new Promise(function(r,e){h.addEventListener("message",function(e){if(e.data.type==="didInit")r()},{once:true})});var T={};l.forEach(function(r){T[r]=function(){var e=arguments;return new Promise(function(t,n){var a=k++;h.addEventListener("message",function e(r){if(r.data.id!==a)return;h.removeEventListener("message",e);if(r.data.type==="resolve")t(r.data.value);else n(r.data.error)});E.then(function(){h.postMessage({type:"call",function:r,args:Array.from(e),id:a})})})}});return{type:"workerFeature",name:i,worker:h,execute:function(e){x(a,i,T)}}}});G.addGrammarElement("jsFeature",function(e,r){if(r.matchToken("js")){var t=r.currentToken().start;var n=null;var a=[];var i="";var o=false;while(r.hasMore()){n=r.consumeToken();if(n.type==="IDENTIFIER"&&n.value==="end"){break}else if(o){if(n.type==="IDENTIFIER"||n.type==="NUMBER"){i+=n.value}else{if(i!=="")a.push(i);i="";o=false}}else if(n.type==="IDENTIFIER"&&n.value==="function"){o=true}}var u=n.start;var s=r.source.substring(t,u)+"\nreturn { "+a.map(function(e){return e+":"+e}).join(",")+" };";var l=new Function(s);return{type:"jsFeature",jsSource:s,function:l,exposedFunctionNames:a,execute:function(){c(b,l())}}}});G.addGrammarElement("jsCmd",function(e,r){if(r.matchToken("js")){var n=[];if(r.matchOpToken("(")){if(r.matchOpToken(")")){}else{do{var t=r.requireTokenType("IDENTIFIER");n.push(t.value)}while(r.matchOpToken(","));r.requireOpToken(")")}}var a=r.currentToken().start;var i=null;while(r.hasMore()){i=r.consumeToken();if(i.type==="IDENTIFIER"&&i.value==="end"){break}}var o=i.start;var u=r.source.substring(a,o);var s=f(Function,n.concat([u]));var l;return l={type:"jsCmd",jsSource:"jsSource",function:s,inputs:n,op:function(t){var r=[];n.forEach(function(e){r.push(R.resolveSymbol(e,t))});var e=s.apply(b,r);if(e&&typeof e.then==="function"){return Promise(function(r){e.then(function(e){t.it=e;r(R.findNext(this))})})}else{t.it=e;return R.findNext(this)}},execute:function(e){return R.unifiedExec(this,e)}}}});G.addGrammarElement("addCmd",function(e,r){if(r.matchToken("add")){var t=e.parseElement("classRef",r);var n=null;if(t==null){n=e.parseElement("attributeRef",r);if(n==null){e.raiseParseError(r,"Expected either a class reference or attribute expression")}}if(r.matchToken("to")){var a=e.parseElement("target",r)}else{var a=e.parseElement("implicitMeTarget")}if(t){var i={type:"addCmd",classRef:t,attributeRef:n,to:a,args:[a],op:function(e,r){R.forEach(r,function(e){e.classList.add(t.className())});return R.findNext(this)},execute:function(e){return R.unifiedExec(this,e)}}}else{var i={type:"addCmd",classRef:t,attributeRef:n,to:a,args:[a,n],op:function(e,r,t){R.forEach(r,function(e){e.setAttribute(t.name,t.value)});return R.findNext(i,e)},execute:function(e){return R.unifiedExec(this,e)}}}return i}});G.addGrammarElement("removeCmd",function(e,r){if(r.matchToken("remove")){var t=e.parseElement("classRef",r);var n=null;var a=null;if(t==null){n=e.parseElement("attributeRef",r);if(n==null){a=e.parseElement("expression",r);if(a==null){e.raiseParseError(r,"Expected either a class reference, attribute expression or value expression")}}}if(r.matchToken("from")){var i=e.parseElement("target",r)}else{var i=e.parseElement("implicitMeTarget")}if(a){var o={type:"removeCmd",classRef:t,attributeRef:n,elementExpr:a,from:i,args:[a],op:function(e,r){R.forEach(r,function(e){e.parentElement.removeChild(e)});return R.findNext(this)},execute:function(e){return R.unifiedExec(this,e)}}}else{var o={type:"removeCmd",classRef:t,attributeRef:n,elementExpr:a,from:i,args:[i],op:function(e,r){if(this.classRef){R.forEach(r,function(e){e.classList.remove(t.className())})}else{R.forEach(r,function(e){e.removeAttribute(n.name)})}return R.findNext(this)},execute:function(e){return R.unifiedExec(this,e)}}}return o}});G.addGrammarElement("toggleCmd",function(e,r){if(r.matchToken("toggle")){var t=e.parseElement("classRef",r);var n=null;if(t==null){n=e.parseElement("attributeRef",r);if(n==null){e.raiseParseError(r,"Expected either a class reference or attribute expression")}}if(r.matchToken("on")){var a=e.parseElement("target",r)}else{var a=e.parseElement("implicitMeTarget")}if(r.matchToken("for")){var i=e.requireElement("Expected a time element","timeExpression",r)}else if(r.matchToken("until")){var o=e.requireElement("Expected event name","dotOrColonPath",r);if(r.matchToken("from")){var u=e.parseElement("expression",r)}}var s={type:"toggleCmd",classRef:t,attributeRef:n,on:a,time:i,evt:o,from:u,toggle:function(e,r){if(this.classRef){R.forEach(e,function(e){e.classList.toggle(t.className())})}else{R.forEach(e,function(e){if(e.hasAttribute(n.name)){e.removeAttribute(n.name)}else{e.setAttribute(n.name,r)}})}},args:[a,n?n.value:null,i,o,u],op:function(t,n,a,r,i,o){if(r){return new Promise(function(e){s.toggle(n,a);setTimeout(function(){s.toggle(n,a);e(R.findNext(s))},r)})}else if(i){return new Promise(function(e){var r=o||t.me;r.addEventListener(i,function(){s.toggle(n,a);e(R.findNext(s))},{once:true});s.toggle(n,a)})}else{this.toggle(n,a);return R.findNext(s)}},execute:function(e){return R.unifiedExec(this,e)}};return s}});G.addGrammarElement("waitCmd",function(e,r){if(r.matchToken("wait")){if(r.matchToken("for")){r.matchToken("a");var t=G.requireElement("Expected event name","dotOrColonPath",r);if(r.matchToken("from")){var n=e.parseElement("expression",r)}var a={type:"waitCmd",event:t,on:n,args:[t,n],op:function(e,t,r){var n=r?r:e.me;return new Promise(function(e){var r=function(){e(R.findNext(a))};n.addEventListener(t,r,{once:true})})},execute:function(e){return R.unifiedExec(this,e)}}}else{var i=G.requireElement("A time expression is required","timeExpression",r);var a={type:"waitCmd",time:i,args:[i],op:function(e,r){return new Promise(function(e){setTimeout(function(){e(R.findNext(a))},r)})},execute:function(e){return R.unifiedExec(this,e)}}}return a}});G.addGrammarElement("dotOrColonPath",function(e,r){var t=r.matchTokenType("IDENTIFIER");if(t){var n=[t.value];var a=r.matchOpToken(".")||r.matchOpToken(":");if(a){do{n.push(r.requireTokenType("IDENTIFIER").value)}while(r.matchOpToken(a.value))}return{type:"dotOrColonPath",path:n,evaluate:function(){return n.join(a?a.value:"")}}}});G.addGrammarElement("sendCmd",function(e,r){if(r.matchToken("send")){var t=e.parseElement("dotOrColonPath",r);var n=e.parseElement("namedArgumentList",r);if(r.matchToken("to")){var a=e.parseElement("target",r)}else{var a=e.parseElement("implicitMeTarget")}var i={type:"sendCmd",eventName:t,details:n,to:a,args:[a,t,n],op:function(e,r,t,n){R.forEach(r,function(e){R.triggerEvent(e,t,n?n:{})});return R.findNext(i)},execute:function(e){return R.unifiedExec(this,e)}};return i}});G.addGrammarElement("returnCmd",function(e,r){if(r.matchToken("return")){var t=e.parseElement("expression",r);var n={type:"returnCmd",value:t,args:[t],op:function(e,r){var t=e.meta.resolve;e.meta.returned=true;if(t){if(r){t(r)}else{t()}}else{e.meta.returned=true;e.meta.returnValue=r}return R.HALT},execute:function(e){return R.unifiedExec(this,e)}};return n}});G.addGrammarElement("triggerCmd",function(e,r){if(r.matchToken("trigger")){var t=e.parseElement("dotOrColonPath",r);var n=e.parseElement("namedArgumentList",r);var a={type:"triggerCmd",eventName:t,details:n,args:[t,n],op:function(e,r,t){R.triggerEvent(e.me,r,t?t:{});return R.findNext(a)},execute:function(e){return R.unifiedExec(this,e)}};return a}});G.addGrammarElement("takeCmd",function(e,r){if(r.matchToken("take")){var t=r.requireTokenType(r,"CLASS_REF");if(r.matchToken("from")){var n=e.parseElement("target",r)}else{var n=e.parseElement("implicitAllTarget")}if(r.matchToken("for")){var a=e.parseElement("target",r)}else{var a=e.parseElement("implicitMeTarget")}var i={type:"takeCmd",classRef:t,from:n,forElt:a,args:[n,a],op:function(e,r,t){var n=this.classRef.value.substr(1);R.forEach(r,function(e){e.classList.remove(n)});R.forEach(t,function(e){e.classList.add(n)});return R.findNext(this)},execute:function(e){return R.unifiedExec(this,e)}};return i}});G.addGrammarElement("logCmd",function(e,r){if(r.matchToken("log")){var t=[e.parseElement("expression",r)];while(r.matchOpToken(",")){t.push(e.parseElement("expression",r))}if(r.matchToken("with")){var n=e.parseElement("expression",r)}var a={type:"logCmd",exprs:t,withExpr:n,args:[n,t],op:function(e,r,t){if(r){r.apply(null,t)}else{console.log.apply(null,t)}return R.findNext(this)},execute:function(e){return R.unifiedExec(this,e)}};return a}});G.addGrammarElement("throwCmd",function(e,r){if(r.matchToken("throw")){var t=e.parseElement("expression",r);var n={type:"throwCmd",expr:t,args:[t],op:function(e,r){var t=e.meta&&e.meta.reject;if(t){t(r);return R.HALT}else{throw r}},execute:function(e){return R.unifiedExec(this,e)}};return n}});G.addGrammarElement("callCmd",function(e,r){if(r.matchToken("call")||r.matchToken("get")){var t=e.parseElement("expression",r);var n={type:"callCmd",expr:t,args:[t],op:function(e,r){e.it=r;return R.findNext(n)},execute:function(e){return R.unifiedExec(this,e)}};return n}});G.addGrammarElement("putCmd",function(e,r){if(r.matchToken("put")){var t=e.parseElement("expression",r);var a=r.matchToken("into")||r.matchToken("before")||r.matchToken("after");if(a==null&&r.matchToken("at")){a=r.matchToken("start")||r.matchToken("end");r.requireToken("of")}if(a==null){e.raiseParseError(r,"Expected one of 'into', 'before', 'at start of', 'at end of', 'after'")}var i=e.parseElement("target",r);var a=a.value;var n=i.propPath.length===0&&a==="into";var o=n&&i.root.type==="symbol";if(n&&!o){e.raiseParseError(r,"Can only put directly into symbols, not references")}var u={type:"putCmd",target:i,operation:a,symbolWrite:o,value:t,args:[i.root,t],op:function(e,r,t){if(o){e[i.root.name]=t}else{if(a==="into"){var n=i.propPath.slice(-1);R.forEach(R.evalTarget(r,i.propPath.slice(0,-1)),function(e){e[n]=t})}else if(a==="before"){R.forEach(R.evalTarget(r,i.propPath),function(e){e.insertAdjacentHTML("beforebegin",t)})}else if(a==="start"){R.forEach(R.evalTarget(r,i.propPath),function(e){e.insertAdjacentHTML("afterbegin",t)})}else if(a==="end"){R.forEach(R.evalTarget(r,i.propPath),function(e){e.insertAdjacentHTML("beforeend",t)})}else if(a==="after"){R.forEach(R.evalTarget(r,i.propPath),function(e){e.insertAdjacentHTML("afterend",t)})}}return R.findNext(this)},execute:function(e){return R.unifiedExec(this,e)}};return u}});G.addGrammarElement("setCmd",function(e,r){if(r.matchToken("set")){var a=e.parseElement("target",r);r.requireToken("to");var t=e.parseElement("expression",r);var n=a.propPath.length===0;var i=n&&a.root.type==="symbol";if(n&&!i){e.raiseParseError(r,"Can only put directly into symbols, not references")}var o={type:"setCmd",target:a,symbolWrite:i,value:t,args:[i?null:a.root,t],op:function(e,r,t){if(i){e[a.root.name]=t}else{var n=a.propPath.slice(-1);R.forEach(R.evalTarget(r,a.propPath.slice(0,-1)),function(e){e[n]=t})}return R.findNext(this)},execute:function(e){return R.unifiedExec(this,e)}};return o}});G.addGrammarElement("ifCmd",function(e,r){if(r.matchToken("if")){var t=e.parseElement("expression",r);r.matchToken("then");var n=e.parseElement("commandList",r);if(r.matchToken("else")){var a=e.parseElement("commandList",r)}if(r.hasMore()){r.requireToken("end")}var i={type:"ifCmd",expr:t,trueBranch:n,falseBranch:a,args:[t],op:function(e,r){if(r){return n}else if(a){return a}else{return R.findNext(this)}},execute:function(e){return R.unifiedExec(this,e)}};e.setParent(n,i);e.setParent(a,i);return i}});G.addGrammarElement("repeatCmd",function(e,r){var t=r.currentToken();if(r.matchToken("repeat")||t.value==="for"){if(r.matchToken("for")){var n=r.requireTokenType("IDENTIFIER");var a=n.value;r.matchToken("in");var i=e.requireElement("Expected an expression","expression",r)}else if(r.matchToken("in")){var a="it";var i=e.requireElement("Expected an expression","expression",r)}else if(r.matchToken("while")){var o=e.requireElement("Expected an expression","expression",r)}else if(r.matchToken("until")){var u=true;if(r.matchToken("event")){var s=G.requireElement("Expected event name","dotOrColonPath",r);if(r.matchToken("from")){var l=e.parseElement("expression",r)}}else{var o=e.requireElement("Expected an expression","expression",r)}}else{r.matchToken("forever");var c=true}if(r.matchToken("index")){var n=r.requireTokenType("IDENTIFIER");var f=n.value}var m=e.parseElement("commandList",r);if(r.hasMore()){r.requireToken("end")}if(a==null){a="_implicit_repeat_"+t.start;var p=a}else{var p=a+"_"+t.start}var v={type:"repeatCmd",identifier:a,indexIdentifier:f,slot:p,expression:i,forever:c,until:u,event:s,on:l,whileExpr:o,resolveNext:function(){return this},loop:m,args:[o],op:function(e,r){var t=e.meta.iterators[p];var n=false;if(this.forever){n=true}else if(this.until){if(s){n=e.meta.iterators[p].eventFired==false}else{n=r!=true}}else if(r){n=true}else{n=t.value!==null&&t.index<t.value.length}if(n){if(t.value){e[a]=t.value[t.index];e.it=t.value[t.index]}else{e.it=t.index}if(f){e[f]=t.index}t.index++;return m}else{e.meta.iterators[p]=null;return R.findNext(this.parent)}},execute:function(e){return R.unifiedExec(this,e)}};e.setParent(m,v);var d={name:"repeatInit",args:[i,s,l],op:function(r,e,t,n){r.meta.iterators[p]={index:0,value:e,eventFired:false};if(s){var a=n||r.me;a.addEventListener(t,function(e){r.meta.iterators[p].eventFired=true},{once:true})}return v},execute:function(e){return R.unifiedExec(this,e)}};e.setParent(v,d);return d}});G.addGrammarElement("fetchCmd",function(e,r){if(r.matchToken("fetch")){var t=e.parseElement("string",r);if(t==null){var t=e.parseElement("nakedString",r)}if(t==null){e.raiseParseError(r,"Expected a URL")}var n=e.parseElement("objectLiteral",r);var i="text";if(r.matchToken("as")){if(r.matchToken("json")){i="json"}else if(r.matchToken("response")){i="response"}else if(r.matchToken("text")){}else{e.raiseParseError(r,"Unknown response type: "+r.currentToken())}}var o={type:"fetchCmd",url:t,argExrepssions:n,args:[t,n],op:function(n,e,a){return new Promise(function(r,t){fetch(e,a).then(function(e){if(i==="response"){n.it=e;r(R.findNext(o))}else if(i==="json"){e.json().then(function(e){n.it=e;r(R.findNext(o))})}else{e.text().then(function(e){n.it=e;r(R.findNext(o))})}}).catch(function(e){R.triggerEvent(n.me,"fetch:error",{reason:e});t(e)})})},execute:function(e){return R.unifiedExec(this,e)}};return o}})}function n(e){R.processNode(e)}function e(e){return R.evaluate(e)}function a(e){if(document.readyState!=="loading"){e()}else{document.addEventListener("DOMContentLoaded",e)}}function i(){var e=document.querySelector('meta[name="htmx-config"]');if(e){return r(e.content)}else{return null}}function o(){var e=i();if(e){_hyperscript.config=c(_hyperscript.config,e)}}function u(e){var r=N.tokenize(e);var t=G.parseHyperScript(r);return G.transpile(t)}if("document"in b){a(function(){o();n(document.body);document.addEventListener("htmx:load",function(e){n(e.detail.elt)})})}return{lexer:N,parser:G,runtime:R,evaluate:e,processNode:n,toJS:u,config:{attributes:"_, script, data-script"}}}()});