(function(e,r){if(typeof define==="function"&&define.amd){define([],r)}else{e._hyperscript=r()}})(typeof self!=="undefined"?self:this,function(){return function(){"use strict";var c=function(){var y={"+":"PLUS","-":"MINUS","*":"MULTIPLY",".":"PERIOD","\\":"BACKSLASH",":":"COLON","%":"PERCENT","|":"PIPE","!":"EXCLAMATION","?":"QUESTION","#":"POUND","&":"AMPERSAND",";":"SEMI",",":"COMMA","(":"L_PAREN",")":"R_PAREN","<":"L_ANG",">":"R_ANG","{":"L_BRACE","}":"R_BRACE","[":"L_BRACKET","]":"R_BRACKET","=":"EQUALS"};function g(e){return I(e)||A(e)||e==="-"||e==="_"}function k(e){return I(e)||A(e)||e==="-"||e==="_"||e===":"}function b(e){return e===" "||e==="\t"||N(e)}function R(e){return"[Line: "+e.line+", Column: "+e.col+"]"}function N(e){return e==="\r"||e==="\n"}function A(e){return e>="0"&&e<="9"}function I(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function C(r,t,e){function a(e,r){m.raiseParseError(e,r)}function n(e){var r=i(e);if(r){return r}else{a(this,"Expected '"+e+"' but found '"+f().value+"'")}}function i(e){if(f()&&f().op&&f().value===e){return p()}}function s(e,r,t,n){var i=o(e,r,t,n);if(i){return i}else{a(this,"Expected one of "+JSON.stringify([e,r,t]))}}function o(e,r,t,n){if(f()&&f().type&&[e,r,t,n].indexOf(f().type)>=0){return p()}}function u(e,r){var t=l(e,r);if(t){return t}else{a(this,"Expected '"+e+"' but found '"+f().value+"'")}}function l(e,r){var r=r||"IDENTIFIER";if(f()&&f().value===e&&f().type===r){return p()}}function p(){var e=r.shift();t.push(e);return e}function c(){return r.length>0}function f(){return r[0]}return{matchOpToken:i,requireOpToken:n,matchTokenType:o,requireTokenType:s,consumeToken:p,matchToken:l,requireToken:u,list:r,source:e,hasMore:c,currentToken:f}}function e(e){var r=e;var t=[];var n=0;var i=0;var a=1;var s="<START>";while(n<r.length){T();if(h()==="-"&&d()==="-"){l()}else{if(!x()&&h()==="."&&I(d())){t.push(p())}else if(!x()&&h()==="#"&&I(d())){t.push(c())}else if(I(h())){t.push(f())}else if(A(h())){t.push(v())}else if(h()==='"'||h()==="'"){t.push(m())}else if(y[h()]){t.push(o(y[h()],E()))}}}return C(t,[],r);function o(e,r){var t=u(e,r);t.op=true;return t}function u(e,r){return{type:e,value:r,start:n,end:n+1,column:i,line:a}}function l(){while(h()&&!N(h())){E()}E()}function p(){var e=u("CLASS_REF");var r=E();while(g(h())){r+=E()}e.value=r;e.end=n;return e}function c(){var e=u("ID_REF");var r=E();while(k(h())){r+=E()}e.value=r;e.end=n;return e}function f(){var e=u("IDENTIFIER");var r=E();while(I(h())){r+=E()}e.value=r;e.end=n;return e}function v(){var e=u("NUMBER");var r=E();while(A(h())){r+=E()}if(h()==="."){r+=E()}while(A(h())){r+=E()}e.value=r;e.end=n;return e}function m(){var e=u("STRING");var r=E();var t="";while(h()&&h()!==r){if(h()==="\\"){E()}t+=E()}if(h()!==r){throw Error("Unterminated string at "+R(e))}else{E()}e.value=t;e.end=n;return e}function h(){return r.charAt(n)}function d(){return r.charAt(n+1)}function E(){s=h();n++;i++;return s}function x(){return I(s)||A(s)||s===")"||s==="}"||s==="]"}function T(){while(h()&&b(h())){if(N(h())){i=0;a++}E()}}}return{tokenize:e}}();var m=function(){var n={};var i={};function e(e,r){n[e]=r}function r(e,r){i[e]=r}function a(e){var r=e.currentToken();var t=e.source;var n=t.split("\n");var i=r?r.line-1:n.length-1;var a=n[i];var s=r?r.column:a.length-1;return a+"\n"+" ".repeat(s)+"^^\n\n"}function s(e,r){r=(r||"Unexpected Token : "+e.currentToken().value)+"\n\n"+a(e);var t=new Error(r);t.tokens=e;throw t}function o(e,r,t){var n=i[e];if(n)return n(m,h,r,t)}function t(e,r){for(var t=0;t<e.length;t++){var n=e[t];var i=o(n,r);if(i){return i}}}function u(e){var r=e.matchTokenType("IDENTIFIER");var t=n[r.value];if(t)return t(m,h,e);s(e)}function l(e){if(e.hasMore()&&f(e.currentToken())){var r=u(e);var t=r;while(e.matchToken("then")){var n=u(e);t.next=n;t=n}return r}else{return{type:"emptyCommandList",transpile:function(){return""}}}}function p(e){e.requireToken("on");var r=o("symbol",e);if(r==null){s(e,"Expected event name")}if(e.matchToken("from")){var t=o("target",e);if(t==null){s(e,"Expected target value")}}else{var t=o("implicitMeTarget",e)}var n=l(e);var i={type:"eventListener",on:r,from:t,start:n,transpile:function(){return"(function(me){"+"var my = me;\n"+"_hyperscript.runtime.forEach(null, "+t.transpile()+", function(target){\n"+"  target.addEventListener('"+r.name+"', function(event){\n"+n.transpile()+"  })\n"+"})\n"+"})"}};return i}function c(e){var r={type:"_hyperscript",eventListeners:[]};do{r.eventListeners.push(p(e))}while(e.matchToken("end")&&e.hasMore());if(e.hasMore()){s(e)}return r}function f(e){return e.type==="IDENTIFIER"&&n[e.value]}function v(e){if(e.next){return"\n"+e.next.transpile()}else{return""}}return{parseExpression:o,parseAnyExpressionOf:t,parseCommand:u,parseCommandList:l,parseHyperScript:c,raiseParseError:s,addCommand:e,addExpression:r,isCommandStart:f,transpileNext:v}}();var h=function(){var n=["_","script","data-script"];function e(e,r){var t=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return t&&t.call(e,r)}function a(e,r){var t;if(window.CustomEvent&&typeof window.CustomEvent==="function"){t=new CustomEvent(e,{bubbles:true,cancelable:true,detail:r})}else{t=document.createEvent("CustomEvent");t.initCustomEvent(e,true,true,r)}return t}function r(e,r,t){var t=t||{};t["sentBy"]=e;var n=a(r,t);var i=e.dispatchEvent(n);return i}function t(e,r,t){if(r.length){for(var n=0;n<r.length;n++){t.call(e,r[n])}}else{t(r)}}function i(e){for(var r=0;r<n.length;r++){var t=n[r];if(e.hasAttribute(t)){return e.getAttribute(t)}}return null}function s(e,n){h.forEach(e,e.eventListeners,function(e){var r=e.transpile();var t=eval(r);t.call(null,n)})}function o(e){n=e}function u(){return n.map(function(e){return"["+e+"]"}).join(", ")}function l(e){throw"TODO - implement"}function p(e){var r=i(e);if(r){var t=c.tokenize(r);var n=m.parseHyperScript(t);s(n,e)}}return{forEach:t,triggerEvent:r,matchesSelector:e,getScript:i,apply:s,setScriptAttrs:o,initElement:p,evaluate:l,getScriptSelector:u}}();m.addExpression("string",function(e,r,t){var n=t.matchTokenType("STRING");if(n){return{type:"string",token:n,transpile:function(){if(n.value.indexOf("'")===0){return"'"+n.value+"'"}else{return'"'+n.value+'"'}}}}});m.addExpression("number",function(e,r,t){var n=t.matchTokenType("NUMBER");if(n){var i=n;var a=parseFloat(n.value);return{type:"number",value:a,numberToken:i,transpile:function(){return i.value}}}});m.addExpression("idRef",function(e,r,t){var n=t.matchTokenType("ID_REF");if(n){return{type:"idRef",value:n.value.substr(1),transpile:function(){return"document.getElementById('"+this.value+"')"}}}});m.addExpression("classRef",function(e,r,t){var n=t.matchTokenType("CLASS_REF");if(n){return{type:"classRef",value:n.value,className:function(){return this.value.substr(1)},transpile:function(){return"document.querySelectorAll('"+this.value+"')"}}}});m.addExpression("attributeRef",function(e,r,t){if(t.matchOpToken("[")){var n=t.matchTokenType("IDENTIFIER");var i=null;if(t.matchOpToken("=")){i=e.parseExpression("expression",t)}t.requireOpToken("]");return{type:"attribute_expression",name:n.value,value:i,transpile:function(){if(this.value){return"({name: '"+this.name+"', value: "+this.value.transpile()+"})"}else{return"({name: '"+this.name+"'})"}}}}});m.addExpression("objectLiteral",function(e,r,t){if(t.matchOpToken("{")){var n=[];if(!t.matchOpToken("}")){do{var i=t.requireTokenType("IDENTIFIER");t.requireOpToken(":");var a=e.parseExpression("expression",t);n.push({name:i,value:a})}while(t.matchOpToken(","));t.requireOpToken("}")}return{type:"objectLiteral",fields:n,transpile:function(){return"({"+n.map(function(e){return e.name.value+":"+e.value.transpile()}).join(", ")+"})"}}}});m.addExpression("symbol",function(e,r,t){var n=t.matchTokenType("IDENTIFIER");if(n){return{type:"symbol",name:n.value,transpile:function(){return n.value}}}});m.addExpression("implicitMeTarget",function(e,r,t){return{type:"implicitMeTarget",transpile:function(){return"[me]"}}});m.addExpression("implicitAllTarget",function(e,r,t){return{type:"implicitAllTarget",transpile:function(){return'document.querySelectorAll("*")'}}});m.addExpression("millisecondLiteral",function(e,r,t){var n=t.requireTokenType(t,"NUMBER");var i=1;if(t.matchToken("s")){i=1e3}else if(t.matchToken("ms")){}return{type:"millisecondLiteral",number:n,factor:i,transpile:function(){return parseFloat(this.number.value)}}});m.addExpression("boolean",function(e,r,t){if(t.matchToken("true")){return{type:"boolean",transpile:function(){return"true"}}}else if(t.matchToken("false")){return{type:"boolean",transpile:function(){return"false"}}}});m.addExpression("leaf",function(e,r,t){return e.parseAnyExpressionOf(["boolean","string","number","idRef","classRef","symbol","propertyRef"],t)});m.addExpression("propertyAccess",function(e,r,t,n){if(t.matchOpToken(".")){var i=t.requireTokenType("IDENTIFIER");var a={type:"propertyAccess",root:n,prop:i,transpile:function(){return n.transpile()+"."+i.value}};return m.parseExpression("indirectExpression",t,a)}});m.addExpression("functionCall",function(e,r,t,n){if(t.matchOpToken("(")){var i=[];do{i.push(e.parseExpression("expression",t))}while(t.matchOpToken(","));t.requireOpToken(")");var a={type:"functionCall",root:n,args:i,transpile:function(){return this.root.transpile()+"("+i.map(function(e){return e.transpile()}).join(",")+")"}};return m.parseExpression("indirectExpression",t,a)}});m.addExpression("indirectExpression",function(e,r,t,n){var i=e.parseExpression("propertyAccess",t,n);if(i){return i}var a=e.parseExpression("functionCall",t,n);if(a){return a}return n});m.addExpression("expression",function(e,r,t){var n=m.parseExpression("leaf",t);if(n){return m.parseExpression("indirectExpression",t,n)}m.raiseParseError(t,"Unexpected value: "+t.currentToken().value)});m.addExpression("target",function(e,r,t){var n=e.parseAnyExpressionOf(["symbol","classRef","idRef"],t);if(n==null){e.raiseParseError(t,"Expected a valid target expression")}return{type:"target",value:n,transpile:function(e){if(n.type==="classRef"){return n.transpile()}else if(n.type==="idRef"){return"["+n.transpile()+"]"}else{return"["+n.transpile()+"]"}}}});m.addCommand("add",function(e,r,t){var n=e.parseExpression("classRef",t);var i=null;if(n==null){i=e.parseExpression("attributeRef",t);if(i==null){e.raiseParseError(t,"Expected either a class reference or attribute expression")}}if(t.matchToken("to")){var a=e.parseExpression("target",t)}else{var a=e.parseExpression("implicitMeTarget")}return{type:"add",classRef:n,attributeRef:i,to:a,transpile:function(){if(this.classRef){return"_hyperscript.runtime.forEach(null, "+a.transpile()+", function (target) {"+"  target.classList.add('"+n.className()+"')"+"})"+e.transpileNext(this)}else{return"_hyperscript.runtime.forEach(null, "+a.transpile()+", function (target) {"+"  target.setAttribute('"+i.name+"', "+i.transpile()+".value)"+"})"+e.transpileNext(this)}}}});m.addCommand("remove",function(e,r,t){var n=e.parseExpression("classRef",t);var i=null;var a=null;if(n==null){i=e.parseExpression("attributeRef",t);if(i==null){a=e.parseExpression("expression",t);if(a==null){e.raiseParseError(t,"Expected either a class reference, attribute expression or value expression")}}}if(t.matchToken("from")){var s=e.parseExpression("target",t)}else{var s=e.parseExpression("implicitMeTarget")}return{type:"remove",classRef:n,attributeRef:i,elementExpr:a,from:s,transpile:function(){if(this.elementExpr){return"_hyperscript.runtime.forEach(null, "+a.transpile()+", function (target) {"+"  target.parentElement.removeChild(target)"+"})"+e.transpileNext(this)}else{if(this.classRef){return"_hyperscript.runtime.forEach(null, "+s.transpile()+", function (target) {"+"  target.classList.remove('"+n.className()+"')"+"})"+e.transpileNext(this)}else{return"_hyperscript.runtime.forEach(null, "+s.transpile()+", function (target) {"+"  target.removeAttribute('"+i.name+"')"+"})"+e.transpileNext(this)}}}}});m.addCommand("toggle",function(e,r,t){var n=e.parseExpression("classRef",t);var i=null;if(n==null){i=e.parseExpression("attributeRef",t);if(i==null){e.raiseParseError(t,"Expected either a class reference or attribute expression")}}if(t.matchToken("on")){var a=e.parseExpression("target",t)}else{var a=e.parseExpression("implicitMeTarget")}return{type:"toggle",classRef:n,attributeRef:i,on:a,transpile:function(){if(this.classRef){return"_hyperscript.runtime.forEach(null, "+a.transpile()+", function (target) {"+"  target.classList.toggle('"+n.className()+"')"+"})"+e.transpileNext(this)}else{return"_hyperscript.runtime.forEach(null, "+a.transpile()+", function (target) {"+"  if(target.hasAttribute('"+i.name+"')) {\n"+"    target.removeAttribute('"+i.name+"');\n"+"  } else { \n"+"    target.setAttribute('"+i.name+"', "+i.transpile()+".value)"+"  }"+"})"+e.transpileNext(this)}}}});m.addCommand("wait",function(e,r,t){return{type:"wait",time:e.parseExpression("millisecondLiteral",t),transpile:function(){return"setTimeout(function () { "+e.transpileNext(this)+" }, "+this.time.transpile()+")"}}});m.addCommand("send",function(e,r,t){var n=t.requireTokenType(t,"IDENTIFIER");var i=e.parseExpression("objectLiteral",t);if(t.matchToken("to")){var a=e.parseExpression("target",t)}else{var a=e.parseExpression("implicitMeTarget")}return{type:"send",eventName:n,details:i,to:a,transpile:function(){return"_hyperscript.runtime.forEach(null, "+a.transpile()+", function (target) {"+"  _hyperscript.runtime.triggerEvent(target, '"+n.value+"',"+(i?i.transpile():"{}")+")"+"})"+e.transpileNext(this)}}});m.addCommand("take",function(r,e,t){var n=t.requireTokenType(t,"CLASS_REF");if(t.matchToken("from")){var i=r.parseExpression("target",t)}else{var i=r.parseExpression("implicitAllTarget")}return{type:"take",classRef:n,from:i,transpile:function(){var e=this.classRef.value.substr(1);return"  _hyperscript.runtime.forEach(this, "+i.transpile()+", function (target) { target.classList.remove('"+e+"') }); "+"me.classList.add('"+e+"');"+r.transpileNext(this)}}});m.addCommand("log",function(e,r,t){var n=[e.parseExpression("expression",t)];while(t.matchOpToken(",")){n.push(e.parseExpression("expression",t))}if(t.matchToken("with")){var i=e.parseExpression("expression",t)}return{type:"log",exprs:n,withExpr:i,transpile:function(){if(i){return i.transpile()+"("+n.map(function(e){return e.transpile()}).join(", ")+")"+e.transpileNext(this)}else{return"console.log("+n.map(function(e){return e.transpile()}).join(", ")+")"+e.transpileNext(this)}}}});m.addCommand("call",function(e,r,t){return{type:"call",expr:e.parseExpression("expression",t),transpile:function(){return"var it = "+this.expr.transpile()+e.transpileNext(this)}}});m.addCommand("put",function(t,e,r){var n=t.parseExpression("expression",r);var i=r.matchToken("into")||r.matchToken("before")||r.matchToken("afterbegin")||r.matchToken("beforeend")||r.matchToken("after");if(i==null){t.raiseParseError(r,"Expected one of 'into', 'before', 'afterbegin', 'beforeend', 'after'")}var a=t.parseExpression("target",r);var s=[];while(r.matchOpToken(".")){s.push(r.requireTokenType("IDENTIFIER").value)}var o=s.length===0&&i.value==="into";var u=o&&a.value.type==="symbol";if(o&&!u){t.raiseParseError(r,"Can only put directly into symbols, not references")}return{type:"put",target:a,propPath:s,op:i.value,symbolWrite:u,value:n,transpile:function(e){if(this.symbolWrite){return"var "+a.value.name+" = "+n.transpile()+t.transpileNext(this)}else{var r=s.length===0?"":"."+s.join(".");if(this.op==="into"){return"_hyperscript.runtime.forEach(null, "+a.transpile()+", function (target) {"+"  target"+r+"="+n.transpile()+"})"+t.transpileNext(this)}else if(this.op==="before"){return"_hyperscript.runtime.forEach(null, "+a.transpile()+", function (target) {"+"  target"+r+".insertAdjacentHTML('beforebegin', "+n.transpile()+")"+"})"+t.transpileNext(this)}else if(this.op==="afterbegin"){return"_hyperscript.runtime.forEach(null, "+a.transpile()+", function (target) {"+"  target"+r+".insertAdjacentHTML('afterbegin', "+n.transpile()+")"+"})"+t.transpileNext(this)}else if(this.op==="beforeend"){return"_hyperscript.runtime.forEach(null, "+a.transpile()+", function (target) {"+"  target"+r+".insertAdjacentHTML('beforeend', "+n.transpile()+")"+"})"+t.transpileNext(this)}else if(this.op==="after"){return"_hyperscript.runtime.forEach(null, "+a.transpile()+", function (target) {"+"  target"+r+".insertAdjacentHTML('afterend', "+n.transpile()+")"+"})"+t.transpileNext(this)}}}}});m.addCommand("if",function(e,r,t){var n=e.parseExpression("expression",t);var i=e.parseCommandList(t);if(t.matchToken("else")){var a=e.parseCommandList(t)}if(t.hasMore()){t.requireToken("end")}return{type:"if",expr:n,trueBranch:i,falseBranch:a,transpile:function(){return"if("+n.transpile()+"){"+""+i.transpile()+"}"+"   else {"+(a?a.transpile():"")+"}"}}});function e(e){if(e){h.setScriptAttrs(e)}var r=function(){var e=document.querySelectorAll(h.getScriptSelector());h.forEach(document,e,function(e){t(e)})};if(document.readyState!=="loading"){r()}else{document.addEventListener("DOMContentLoaded",r)}return true}function t(e){h.initElement(e)}function r(e){return h.evaluate(e)}return{lexer:c,parser:m,runtime:h,evaluate:r,init:t,start:e}}()});