(function(e,t){if(typeof define==="function"&&define.amd){define([],t)}else{e.hypescript=t()}})(typeof self!=="undefined"?self:this,function(){return function(){"use strict";var r=function(){var x={"+":"PLUS","-":"MINUS","*":"MULTIPLY",".":"PERIOD","\\":"BACKSLASH",":":"COLON","%":"PERCENT","|":"PIPE","!":"EXCLAMATION","?":"QUESTION","#":"POUND","&":"AMPERSAND",";":"SEMI",",":"COMMA","(":"L_PAREN",")":"R_PAREN","<":"L_ANG",">":"R_ANG","{":"L_BRACE","}":"R_BRACE","[":"L_BRACKET","]":"R_BRACKET","=":"EQUALS"};function y(e){return b(e)||N(e)||e==="-"||e==="_"}function k(e){return b(e)||N(e)||e==="-"||e==="_"||e===":"}function I(e){return e===" "||e==="\t"||R(e)}function g(e){return"[Line: "+e.line+", Column: "+e.col+"]"}function R(e){return e==="\r"||e==="\n"}function N(e){return e>="0"&&e<="9"}function b(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function A(u,t,e){function r(e){var t=n(e);if(t){return t}else{raiseError(u,"Expected  "+e)}}function n(e){if(l()&&l().value===e&&l().type!=="STRING"){return s()}}function a(e,t,r){var n=o(e,t,r);if(n){return n}else{raiseError(u,"Expected one of "+JSON.stringify([e,t,r]))}}function o(e,t,r){if(l()&&l().type&&[e,t,r].indexOf(l().type)>=0){return s()}}function i(e,t){var r=c(e,t);if(r){return r}else{raiseError(u,"Expected token "+e)}}function c(e,t){var t=t||"IDENTIFIER";if(l()&&l().value===e&&l().type===t){return s()}}function s(){var e=u.shift();t.push(e);return e}function f(){return u.length>0}function l(){return u[0]}return{matchOpToken:n,requireOpToken:r,matchTokenType:o,requireTokenType:a,consumeToken:s,matchToken:c,requireToken:i,list:u,source:e,hasMore:f,currentToken:l}}function e(e){var t=e;var r=[];var n=0;var u=0;var a=1;var o="START";while(n<t.length){d();if(m()==="-"&&T()==="-"){c()}else{if(h()&&m()==="."&&b(T())){r.push(s())}else if(h()&&m()==="#"&&b(T())){r.push(f())}else if(b(m())){r.push(l())}else if(N(m())){r.push(v())}else if(m()==='"'){r.push(p())}else if(x[m()]){r.push(i(x[m()],E()))}}}return A(r,[],t);function i(e,t){return{type:e,value:t,start:n,end:n+1,column:u,line:a}}function c(){while(!R(m())){E()}E()}function s(){var e=i("CLASS_REF");var t=E();while(y(m())){t+=E()}e.value=t;e.end=n;return e}function f(){var e=i("ID_REF");var t=E();while(k(m())){t+=E()}e.value=t;e.end=n;return e}function l(){var e=i("IDENTIFIER");var t=E();while(b(m())){t+=E()}e.value=t;e.end=n;return e}function v(){var e=i("NUMBER");var t=E();while(N(m())){t+=E()}if(m()==="."){t+=E()}while(N(m())){t+=E()}e.value=t;e.end=n;return e}function p(){var e=i("STRING");E();var t="";while(m()&&m()!=='"'){if(m()==='")'){E()}t+=E()}if(m()!=='"'){throw Error("Unterminated string at "+g(e))}else{E()}e.value=t;e.end=n;return e}function m(){return t.charAt(n)}function T(){return t.charAt(n+1)}function E(){o=m();n++;u++;return o}function h(){return o==="START"||I(o)}function d(){while(m()&&I(m())){if(R(m())){u=0;a++}E()}}}return{tokenize:e}}();var f=function(){function e(e){var t=e.requireTokenType(e,"NUMBER");var r=1;if(e.matchToken("s")){r=1e3}else if(e.matchToken("ms")){}return parseFloat(t.value)*r}function n(e,t,r){if(e.matchToken(t)||t==null){return{type:"target",value:e.requireTokenType("IDENTIFIER","CLASS_REF","ID_REF").value}}else if(r){o(e,"Required token '"+t+"' not found")}}function a(e,t){if(e.matchOpToken(".")){var r=e.requireTokenType("IDENTIFIER");var n={type:"dereference",root:t,prop:r,evaluate:function(e,t,r){var n=e.root.evaluate(e.root,t,r);return n[e.prop.value]}};return a(e,n)}else{return t}}function t(e){var t=e.matchTokenType("STRING");if(t){return{type:"string",value:t.value,evaluate:function(e){return e.value}}}var r=e.matchTokenType("NUMBER");if(r){return{type:"number",value:r.value,evaluate:function(e){return e.value}}}var n=e.matchTokenType("IDENTIFIER");if(n){var u={type:"variable",value:n.value,evaluate:function(e,t,r){if(e.value==="me"||e.value==="my"){return t}else{return r[e.value]}}};return a(e,u)}o(e,"Unexpected value: "+e.currentToken().value)}function r(e){var t=e.matchTokenType("CLASS_REF");if(t){return{name:"class",value:t.value.substr(1)}}else{var r=e.matchTokenType("IDENTIFIER");e.matchOpToken("=");var n=e.matchTokenType("IDENTIFIER","STRING");return{name:r.value,value:n.value}}}function u(e){var t=null;var r=null;while(e.hasMore()){if(e.currentToken()!=="then"){r=e.consumeToken()}if(t==null){t=r}}return e.source.substr(t.start,r.end)}function o(e,t){t=t||"Unexpected Token : "+e.currentToken().value;var r=new Error(t);r.tokens=e;throw r}function i(e){var t=e.matchTokenType("IDENTIFIER");var r=v[t.value];if(r)return r(f,l,e);o(e)}function c(e){var t={type:"command_list",on:n(e,"on",true),from:n(e,"from"),start:i(e)};var r=t.start;while(e.matchToken("then")){r.next=i(e);r=r.next}return t}function s(e){var t={type:"hype_script",commandLists:[]};do{t.commandLists.push(c(e))}while(e.matchToken("end"));return t}return{parseAttributeExpression:r,parseTargetExpression:n,parseValueExpression:t,consumeRestOfCommand:u,parseInterval:e,parseCommandList:c,parseHypeScript:s}}();var l=function(){function e(e,t){var r=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return r&&r.call(e,t)}function t(e,t,r){var n=u(e,t);a(n,function(e){r(e)})}function r(e,t,r){var r=r||{};r["sentBy"]=e;var n=i(t,r);var u=e.dispatchEvent(n);return u}function u(e,t){if(e){if(e.value==="me"||e.value==="my"){return[t]}else{return document.querySelectorAll(e.value)}}else{return[t]}}function a(e,t){for(var r=0;r<e.length;r++){t(e[r])}}function n(e,t,r){if(e.next){e.next.exec(e.next,t,r)}}function o(e,t,r){return e.evaluate(e,t,r)}function i(e,t){var r;if(window.CustomEvent&&typeof window.CustomEvent==="function"){r=new CustomEvent(e,{bubbles:true,cancelable:true,detail:t})}else{r=document.createEvent("CustomEvent");r.initCustomEvent(e,true,true,t)}return r}return{forEach:a,triggerEvent:r,evalTargetExpr:u,forTargets:t,evaluate:o,execNext:n,matchesSelector:e,makeEvent:i}}();var v={};function e(e,t){v[e]=t}e("add",function(e,n,t){return{type:"add",attribute:e.parseAttributeExpression(t),to:e.parseTargetExpression(t,"to"),exec:function(t,e,r){n.forTargets(t.to,e,function(e){if(t.attribute.name==="class"){e.classList.add(t.attribute.value)}else{e.setAttribute(t.attribute.name,t.attribute.value)}});n.execNext(t,e,r)}}});e("remove",function(e,n,t){return{type:"remove",attribute:e.parseAttributeExpression(t),from:e.parseTargetExpression(t,"from"),exec:function(t,e,r){n.forTargets(t.from,e,function(e){if(t.attribute.name==="class"){e.classList.remove(t.attribute.value)}else{e.removeAttribute(t.attribute.name)}});n.execNext(t,e,r)}}});e("toggle",function(e,n,t){return{type:"toggle",attribute:e.parseAttributeExpression(t),on:e.parseTargetExpression(t,"on"),exec:function(t,e,r){n.forTargets(t.on,e,function(e){if(t.attribute.name==="class"){e.classList.toggle(t.attribute.value)}else{if(e.getAttribute(t.attribute.name)){e.removeAttribute(t.attribute.name)}else{e.setAttribute(t.attribute.name,t.attribute.value)}}});n.execNext(t,e,r)}}});e("eval",function(e,n,t){var r={type:"eval",eval:e.consumeRestOfCommand(t),exec:function(e,t,r){eval(e.eval);n.execNext(e,t,r)}};return r});e("wait",function(e,n,t){return{type:"wait",time:e.parseInterval(t),exec:function(e,t,r){setTimeout(function(){n.execNext(e,t,r)},e.time)}}});e("send",function(e,n,t){var r=t.requireTokenType(t,"IDENTIFIER");var u=[];if(t.matchOpToken("{")){do{var a=t.requireTokenType(t,"IDENTIFIER");t.requireOpToken(":");var o=e.parseValueExpression(t);u.push([a,o])}while(t.matchOpToken(","));t.requireOpToken("}")}var i=e.parseTargetExpression(t,"to");return{type:"send",eventName:r,details:u,to:i,exec:function(r,e,t){n.forTargets(r.to,e,function(e){var t={};n.forEach(r.details,function(e){t[e[0].value]=n.evaluate(e[1])});n.triggerEvent(e,r.eventName.value,t)});n.execNext(r,e,t)}}});e("take",function(e,u,t){return{type:"take",classRef:t.requireTokenType(t,"CLASS_REF"),from:e.parseTargetExpression(t,"from"),exec:function(e,t,r){var n=e.classRef.value.substr(1);u.forTargets(e.from,t,function(e){e.classList.remove(n)});t.classList.add(n);u.execNext(e,t,r)}}});e("debug",function(e,n,t){return{type:"debug",exec:function(e,t,r){console.log(e,t,r);n.execNext(e,t,r)}}});e("set",function(e,r,t){var n=e.parseTargetExpression(t);var u=[];while(t.matchOpToken(".")){u.push(t.requireTokenType("IDENTIFIER").value)}t.requireToken("to");var a=e.parseValueExpression(t);return{type:"set",target:n,propPath:u,value:a,exec:function(n,e,t){var u=r.evaluate(n.value,e,t);r.forTargets(n.target,e,function(e){var t=e;var r=n.propPath.slice();while(r.length>1){t=t[r.shift()]}t[r[0]]=u});r.execNext(n,e,t)}}});function u(e){var t=r.tokenize(e);return f.parseHypeScript(t)}function a(r,n){return function(e){var t={me:n,event:e};r.start.exec(r.start,n,t)}}function o(e,n){l.forEach(e.commandLists,function(t){var r=t.on.value;l.forTargets(t.from,n,function(e){e.addEventListener(r,a(t,n))})})}function i(e){if(e){var t=e.getAttribute("_")||e.getAttribute("hs")||e.getAttribute("data-hs");if(t){var r=u(t);o(r,e)}}else{var n=function(){var e=document.querySelectorAll("[_], [hs], [data-hs]");for(var t=0;t<e.length;t++){var r=e[t];i(r)}};if(document.readyState!=="loading"){n()}else{document.addEventListener("DOMContentLoaded",n)}}}return{lexer:r,parser:f,runtime:l,addCommand:e,getHyped:i}}()});