<div class="hdb" style="border:1px solid black;padding:1em;position:fixed;top:0;right:0;width:50%;height:90%;overflow:scroll" _="
	on load or step from hdb.bus trigger update
	on continue from hdb.bus remove me">

	<script type="text/hyperscript">
	def highlightDebugCode
		set start to hdb.cmd.startToken.start
		set end to hdb.cmd.endToken.end
		set src to hdb.cmd.programSource
		set beforeCmd to escapeHTML(src.substring(0, start))
		set cmd to escapeHTML(src.substring(start, end))
		set afterCmd to escapeHTML(src.substring(end))
		return beforeCmd+"<strong class=current>"+cmd+"</strong>"+afterCmd
	end

	def escapeHTML(unsafe)
		js(unsafe) return unsafe
			.replace(/&/g, "&amp;")
			.replace(/</g, "&lt;")
			.replace(/>/g, "&gt;")
			.replace(/\x22/g, "&quot;")
			.replace(/\x27/g, "&#039;") end
		return it
	end
	</script>

	<h2>HDB///_hyperscript/debugger</h2>
	<ul role="toolbar" class="hdb__toolbar">
	<li> <button _="on click call hdb.continueExec()">Continue</button>
	<li> <button _="on click call hdb.stepOver()">Step Over</button>
	</ul>

	<h3>Debugging</h3>

	<pre class="hdb__code" _="on update from .hdb
		                      put highlightDebugCode() into me"></pre>

	<h3>Context</h3>

	<table class="hdb__context" _="
		on update from .hdb
		set my.innerHTML to ''
		repeat for var in hdb.ctx
			get '<tr><th>$var<td>${hdb.ctx[var]}'
			put it at end of me
		end"></table>
</div>
